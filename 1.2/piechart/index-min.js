KISSY.add("gallery/kcharts/1.2/piechart/animation",function(t,e){function n(e,n,o){function h(){b||(f=+new Date,k=!0)}function c(){var t=+new Date;x=x+t-f,k=!1}o||(o={}),o=t.merge(a,o);var u,l,f,d=+new Date,g=(d+o.duration,d),p=o.duration,v=i[o.easing],m=o.frame||t.noop,w={},b=!1,y=o.duration,M=0,x=0,k=!1;for(var A in e)n[A]||n[A]==0?w[A]=null:delete e[A];u=function(){var a,i;if(i=M/p,a=v(i),t.isArray(e))for(var s=0,h=e.length;h>s;s++)w[s]=e[s]+(n[s]-e[s])*a;else for(var c in e)w[c]=e[c]+(n[c]-e[c])*a;y>M?(m.call(C,w,i),l=r(u)):(m.call(C,n,1),b=!0,o.endframe&&o.endframe.call(C,n,1)),g=+new Date,M=g-d-x};var C={stop:function(){s(l)},resume:function(){k&&(c(),u())},pause:function(){k||(h(),s(l))},isRunning:function(){return!b}};return u(),C}var a,i=e.Easing,r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)},s=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;return a={duration:1e3,easing:"easeNone"},n.AnimateObject=function(e,a){var i=[],r=0,s={},o={},h=e.length;t.each(e,function(t,e){var n,a=t.from,h=t.to;for(var c in a)n=r++,i[n]=[t,c,e],s[n]=a[c],o[n]=h[c]});var c=n(s,o,{easing:a.easing,duration:a.duration,frame:function(t){for(var e in t){var n=i,a=n[e][0],r=n[e][1],s=n[e][2],o=a.from;o[r]=t[e],a.frame&&a.frame(r,t[e],t,s,h)}},endframe:function(t){for(var e in t){var n=i,r=n[e][0],s=n[e][1],o=n[e][2];r.endframe&&r.endframe(s,t[e],o,t)}a.endframe&&a.endframe()}});return c},n},{requires:["anim"]}),KISSY.add("gallery/kcharts/1.2/piechart/label",function(t){function e(t,e){var n,a,i,r;return n=t[0],i=t[1],a=e[0],r=e[1],Math.sqrt(Math.pow(n-a,2)+Math.pow(i-r,2))}function n(t,n,a){function i(t,r,s,o){if(a>=t.length)return{min:s,left:o};if(r>e(n,t[0])){var h=t.slice(1);return i(h,e(n,t[0]),t[0],h)}return i(t.slice(1),r,s,o)}return i(t,1/0,t[0],[])}function a(t,e){function a(t,e,i){if(t.length==0)return i;var r=n(e,t[0],t.length-1);return i.push(r.min),a(t.slice(1),r.left,i)}return a(t,e,[])}function i(e){return o||(o=t.Node("<div/>").css({visibility:"hidden",position:"fixed",left:"-9999em",top:0}).appendTo(document.body)),o.html(e),{width:h.width(o),height:h.height(o)}}function r(t){this.set(t),this.init()}function s(e,n,s){var o,h,c,u,l,f,d,g=e.get("paper"),p=(e.get("container"),n.length,[]),v=[],m=[],w=e.get("cx"),b=e.get("cy"),y=e.get("rs"),M=e.get("padding")||20,x=M+10,k=(Math.cos,Math.sin,Math.asin,Math.PI,Math.PI/180);if(this.labels=[],d=n[0]){for(o=i(d.get("label")).height,u=Math.max.apply(Math,y),l=u+M,f=u+x,h=b-f,c=b+f,h+=o;c-o>h;h+=o){var A=h,C=Math.asin((A-b)/f),I=w+f*Math.cos(C);I=s?2*w-I:I,p.push([I,A])}n.length>p.length&&(n=n.sort(function(t,e){var n=Math.abs(t.get("start")-t.get("end")),a=Math.abs(e.get("start")-e.get("end"));return n>a?-1:a>n?1:0}),n=n.slice(0,p.length)),n=n.sort(function(t,e){var n=t.get("middley"),a=e.get("middley");return a>n?1:n>a?-1:0}),Math.PI/180,t.each(n,function(t){var e,n,a=i=t.get("middlex"),i=t.get("middley"),r=t.get("middleangle")*k;e=w+l*Math.cos(-r),n=b+l*Math.sin(-r),m.push([e,n]),v.push([a,i])}),v=v.reverse(),m=m.reverse(),n=n.reverse();for(var F=a(v,p),S=0,$=F.length;$>S;S++){var R,D,j,B,L=v[S],P=F[S];R=L[0],j=L[1],D=P[0],B=P[1];var E,q;E=m[S][0],q=m[S][1];var z,O=B;z=s?D-10:D+10;var _=g.path(["M",R,j,"Q",E,q,z,O].join(","));_&&_.toBack&&_.toBack();var T,K,N=n[S],Y=e.get("sizefn"),G=N.get("label"),Q=i(G),U=this;Y&&t.isFunction(Y)&&(Q=Y(Q,N,e)),s?(T=z-Q.width,K=O-Q.height/2):(T=z,K=O-Q.height/2);var H=t.Node("<div class='kcharts-label'>"+G+"</div>"),J=new r({label:H,sector:N,$path:_,x:T,y:K,size:Q,pie:e}),V=J.get("el"),W=function(t,e,n){t.on("click",function(t){U.fire("click",{el:t.currentTarget,label:n,sector:e})})};W(V,N,J),U.labels.push(J)}}}var o,h=t.DOM;return t.extend(r,t.Base,{init:function(){var t=this.get("label"),e=this.get("x"),n=this.get("y"),a=this.get("size"),i=this.get("pie"),r=(this.get("sector"),i.get("container"));t.css({position:"absolute",left:e+"px",top:n+"px",width:a.width+"px",height:a.height+"px"}).appendTo(r),this.set("el",t)}}),t.extend(s,t.Base),s.getSizeOf=i,s}),KISSY.add("gallery/kcharts/1.2/piechart/sector",function(t){function e(t,e,n,a,i){Math.abs(a-i)>=360&&(i+=.01),a==i&&(i-=.1);var r,s=Math.PI/180,o=(a+i)/2,h=t+n*Math.cos(-o*s),c=t+n*Math.cos(-o*s)*.5,u=t+n*Math.cos(-a*s),l=t+n*Math.cos(-i*s),f=e+n*Math.sin(-o*s),d=e+n*Math.sin(-o*s)*.5,g=e+n*Math.sin(-a*s),p=e+n*Math.sin(-i*s),v=+(Math.abs(a-i)>180),m=1;return r=["M",t,e,"L",u,g,"A",n,n,0,v,m,l,p,"z"],r.middleangle=o,r.middlex=h,r.middley=f,r.cx=c,r.cy=d,r.A=[u,g],r.B=[l,p],r}function n(t,e,n,a,i,r){Math.abs(i-r)>=360&&(r+=.01),i==r&&(r-=.1);var s=Math.PI/180,o=(i+r)/2,h=t+a*Math.cos(-o*s),c=t+.5*(n+a)*Math.cos(-o*s)*.5,u=(t+n*Math.cos(-o*s),t+n*Math.cos(-i*s)),l=t+n*Math.cos(-r*s),f=t+a*Math.cos(-i*s),d=t+a*Math.cos(-r*s),g=e+a*Math.sin(-o*s),p=e+.5*(n+a)*Math.sin(-o*s)*.5,v=(e+n*Math.sin(-o*s),e+n*Math.sin(-i*s)),m=e+n*Math.sin(-r*s),w=e+a*Math.sin(-i*s),b=e+a*Math.sin(-r*s),y=["M",f,w,"L",u,v,"A",n,n,0,+(Math.abs(r-i)>180),1,l,m,"L",d,b,"A",a,a,0,+(Math.abs(r-i)>180),0,f,w];return y.middleangle=o,y.middlex=h,y.middley=g,y.cx=c,y.cy=p,y.A=[u,v],y.B=[f,w],y.C=[l,m],y.D=[d,b],y}function a(t,e,n,i,r,s,o,h){return this instanceof a?(this.set({cx:e,cy:n,r:i,start:r,end:s,pathcfg:o,paper:t,framedata:h}),this.draw(),this.bindEvent(),this):new a(t,e,n,i,r,s,o)}return t.extend(a,t.Base,{bindEvent:function(){this.on("afterCxChange",function(){this.draw()}),this.on("afterCyChange",function(){this.draw()}),this.on("afterStartChange",function(){this.draw()}),this.on("afterEndChange",function(){this.draw()}),this.on("afterRChange",function(){this.draw()});var t=this.get("$path"),e=this;t.click(function(){e.fire("click")}),t.mouseout(function(){e.fire("mouseout")}),t.mouseover(function(){e.fire("mouseover")})},unbindEvent:function(){this.detach();var t=this.get("$path");t.unclick(),t.unmouseover(),t.unmouseout()},_syncAttrFromPath:function(t){this.set({middleangle:t.middleangle,sectorcx:t.cx,sectorcy:t.cy,middlex:t.middlex,middley:t.middley,centerpoint:t.cc,A:t.A,B:t.B})},draw:function(){var e=this.get("r"),n=this.get("paper"),a=this.get("pathcfg"),i=this.get("framedata"),r=n.path();a=t.merge({stroke:"#000",fill:"#fff"},a),i&&(a=t.merge(a,{fill:i.fill})),r.attr(a),this.set("$path",r),t.isArray(e)&&e.length==2?this._drawDonut():this._drawSector()},_drawSector:function(){var t,n=this.get("cx"),a=this.get("cy"),i=this.get("r"),r=this.get("start"),s=this.get("end"),o=e(n,a,i,r,s),h=o.join(",");return this.get("paper"),t=this.get("$path"),t.attr("path",h),this._syncAttrFromPath(o),this.draw=this._drawSector,this},_drawDonut:function(){var t,e=this.get("cx"),a=this.get("cy"),i=this.get("r"),r=this.get("start"),s=this.get("end"),o=n(e,a,i[0],i[1],r,s),h=o.join(",");return this.get("paper"),t=this.get("$path"),t.attr("path",h),this._syncAttrFromPath(o),this.draw=this._drawDonut,this},destroy:function(){this.unbindEvent(),this.get("$path").remove()}}),a}),KISSY.add("gallery/kcharts/1.2/piechart/util",function(t,e,n,a){function i(t){function e(t){for(var r=0,s=t.length;s>r;r++)a.call(t[r])==i?e(t[r]):n.push(t[r])}var n=[],a=Object.prototype.toString,i=a.call(t);return e(t),n}function r(e,n){function a(e,r){for(var s=0,o=e.length;o>s;s++)t.isArray(e[s])?a(e[s],r++):n(e[s])&&(i[r]||(i[r]=[]),i[r].push(e[s]))}var i=[];return a(e,0),i}function s(e,n){function a(e,i){for(var o=0,h=e.length;h>o;o++)if(t.isArray(e[o].data)){var c=i.push(t.mix({},e[o],!0,["label"]));i[c].data=[],a(e[o].data,i[c].data)}else{var u=e[o].data,l=u/s;n(u,l)?i.push(e[o]):r+=e[o].data}}var i=[],r=0,s=u(e);return a(e,i),i.push({label:"\u5176\u5b83",data:r}),i}function o(t){function e(t){for(var n,a=[],i=0,r=t.length;r>i;i++)typeof t[i].data=="object"&&a.push(1+e(t[i].data));return n=a.length?Math.max.apply(null,a):0}var n=e(t);return n+1}function h(t,e){for(var n=0,a=0,i=t.length;i>a;a++){var r=e(t[a]);r&&(n+=r)}return n}function c(e){return h(e,function(e){return e.value&&t.isNumber(e.value)?e.value:0})}function u(e){for(var n=0,a=0,i=e.length;i>a;a++)n+=t.isArray(e[a].data)?u(e[a].data):e[a].data;return n}function l(t){function e(t,r,s){for(var o=0,h=t.length;h>o;o++){var c;if(c=s?s:o+1,M(t[o].data)){var l=u(t[o].data);t[o].value=l,a[r]||(a[r]=[]),a[r].push(t[o]),i[c-1]||(i[c-1]=[]),i[c-1].push(t[o]),e(t[o].data,r+1,c)}else{if(t[o].value=t[o].data,a[r]||(a[r]=[]),a[r].push(t[o]),n-1>r){var f=r+1;for(t[o].crossdepth=r;n>f;)a[f]||(a[f]=[]),a[f].push(t[o]),f++}i[c-1]||(i[c-1]=[]),i[c-1].push(t[o])}}}var n,a=[],i=[],r={};return n=o(t),e(t,0),r.groups=a,r.set=i,r}function f(t,e){var n,a=this.el.get("start"),i=this.prev,r=this.el.get("donutIndex");r&&(a=i.el.get("end")),n=a-e,this.el.set("start",a),this.el.set("end",n)}function d(t,n){for(var a=n.get("rs"),i=[],r=n.get("interval")||2,s=n.get("paper"),o=n.get("cx"),h=n.get("cy"),u=n.get("pathcfg"),l=!!n.get("donut"),d=0,g=t.length;g>d;d++)for(var p=s.set(),v=c(t[d]),m=0,w=0,b=t[d].length;b>w;w++){var y,M,x=t[d],k=x[w],A=typeof k.crossdepth=="number";if(!(A&&g-1>d)){y=d?A?k.crossdepth==0?[a[d]]:[a[k.crossdepth-1]+r,a[d]]:[a[d-1]+r,a[d]]:a[d],l&&1==g&&(y=[a[0],a[1]]),k.el=new e(s,o,h,y,90,89,u,k),M=k.el.get("$path"),p.push(M),k.el.set("group",p),k.el.set("groupLength",g),k.el.set("framedata",k);var C=[];if(A)for(var I=k.crossdepth;g>I;)C.push(I),I++;else C.push(d);k.el.set("groupIndex",C),k.el.set("donutIndex",w),k.el.set("label",k.label||""),i.push(k.el),function(t){k.el.on("mouseout",function(){n.fire("mouseout",{sector:t})}),k.el.on("mouseover",function(){n.fire("mouseover",{sector:t})}),k.el.on("click",function(){n.fire("click",{sector:t})})}(k.el),k.frame=f,k.from||(k.from={}),k.to||(k.to={}),k.percent=k.value/v,k.from.deg=0,k.to.deg=w==b-1?360-m:k.percent*360,m+=k.percent*360,k.prev=w>0?x[w-1]:x[b-1],k.next=b-1>w?x[w+1]:x[0]}}return i}function g(t,e){for(var n=e.get("paper"),a=0,i=t.length;i>a;a++)for(var r=n.set(),s=0,o=t[a].length;o>s;s++){var h=t[a][s],c=h.el,u=c.get("$path");r.push(u),c.set("set",r)}}function p(t){var e;return(!t||0>t||t>1)&&(e=.1),e}function v(t,e,n){if(n||(n=0),t){this.color=t;var i,r,s,o,h,c=a.getRGB(t);i=a.rgb2hsb(c),r=i.h,s=i.s,o=i.b,h=(s-n)/e,this.step=h,this.h=r,this.s=s,this.b=o}}function m(t,e,i){for(var r=e.get("paper"),s=e.get("color"),o=new n,h=s&&s.initial,c=h&&a.getRGB(h),u=s&&p(s.min),l=new v(c,i,u),f=0,d=t.length;d>f;f++)for(var g=(r.set(),t[f][0].color),m=t[f].length,w=new v(g,m),b=0,y=t[f].length;y>b;b++){var M,x=t[f][b],k=x.el,A=k.get("$path");if(x.color)M=x.color;else{var C;if(C=w.getColor())M=C;else{var I=l.getColor();M=I?I:o.getColor(f+b).DEFAULT}}A.attr("fill",M)}}function w(e){e=r(e,function(t){var e=t.el.get("$path");return t.hide?(e.hide(),!1):(e.show(),!0)});for(var n=0,a=e.length;a>n;n++)for(var i=e[n],s=h(i,function(e){return e.value&&!e.hide&&t.isNumber(e.value)?e.value:0}),o=0,c=0,u=i.length;u>c;c++){var l=i[c];l.el.get("$path"),l.percent=l.value/s,l.to.deg=c==u-1?360-o:l.percent*360,o+=l.percent*360,l.prev=c>0?i[c-1]:i[u-1],l.next=u-1>c?i[c+1]:i[0]}}function b(t){for(t%=360;0>t;)t+=360;return t>=0&&90>=t||t>270&&360>=t?!0:!1}function y(t){var e=l(t.get("data")),n=d(e.groups,t);t.get("color"),t.get("hsb");var a=i(e.groups);return g(e.set,t),m(e.set,t,a.length),{$sectors:n,groups:e.groups,set:e.set,framedata:a}}var M=t.isArray;v.prototype.getColor=function(){var t;return this.color&&(t="hsb("+[this.h,this.s-=this.step,this.b].join(",")+")"),t};var x={initPath:y,fillColor:m,adjustFrameData:w,isRightAngel:b,filterdata:s};return x},{requires:["gallery/kcharts/1.2/piechart/sector","gallery/kcharts/1.1/tools/color/index","gallery/kcharts/1.1/raphael/index"]}),KISSY.add("gallery/kcharts/1.2/piechart/index",function(t,e,n,a,i,r){function s(){this.destroy();var t=this.get("framedata");this.animate(t)}function o(e){var n=t.get(e.renderTo),a=h.width(n),i=h.height(n),s=r(n),o=h.css(n,"position")=="relative"?!0:!1,c=e.rs;e.rs=t.isArray(c)?c:[c],!o&&h.css(n,"position","relative"),this.set({paper:s,width:a,height:i,container:n}),this.set(e),this.adjustCfg(),this.adjustData(),e.autoRender!=0&&this.render()}var h=t.DOM,c=t.Event;return t.extend(o,t.Base,{bindEvent:function(){this.on("afterCxChange",function(){this.drawChart()}),this.on("afterCyChange",function(){this.drawChart()}),this.on("afterRsChange",function(){this.drawChart()}),this.on("afterDataChange",function(){this.drawChart()}),c.on(this.get("container"),"mouseleave",function(){this.fire("mouseleave")},this)},adjustCfg:function(){var e=this.get("anim"),n=this,a=t.isFunction(e.endframe)&&e.endframe,i=n.get("label");e.endframe=function(){0!=i&&n.drawLabel(i),a&&a.call(n),n.fire("afterRender")}},adjustData:function(){var n=this.get("filterfn");if(n&&t.isFunction(n)){var a,i=this.get("data");a=e.filterdata(i,n),this.set("data",a)}},initPath:function(){var t=e.initPath(this);this.set("$sectors",t.$sectors),this.set("groups",t.groups),this.set("set",t.set),this.set("framedata",t.framedata)},render:function(){this.initPath();var e=this.get("framedata");this.animate(e);var n=t.buffer(s,100,this);this.render=n,this.bindEvent()},adjust:function(){var n=this.get("groups").slice(0),a=this.get("framedata");a=t.filter(a,function(t){return!t.hide}),e.adjustFrameData(n,this),this.animate(a)},animate:function(t){var e=this,n=this.get("anim");this.isRunning()&&this.stop(),e.fire("beginRender"),this.animateInstance=a.AnimateObject(t,n)},drawLabel:function(){var n,a,r=[],s=[],o=this.get("$sectors");t.each(o,function(n){var a=n.get("middleangle"),i=n.get("groupLength"),o=n.get("groupIndex"),h=e.isRightAngel(a);t.indexOf(i-1,o)>-1?h?s.push(n):(n.set("isleft",!0),r.push(n)):h?n.set("isright",!0):n.set("isleft",!0)}),n=new i(this,r,!0),a=new i(this,s,!1),n.on("click",this.onLabelClick,this),a.on("click",this.onLabelClick,this),this.set("$labels",[].concat(n,a))},drawSetLabel:function(){},onLabelClick:function(t){this.fire("labelclick",{el:t.el,label:t.label,sector:t.sector})},isRunning:function(){return this.animateInstance&&this.animateInstance.isRunning()},stop:function(){this.animateInstance&&(this.animateInstance.stop(),delete this.animateInstance)},destroy:function(){var e=this.get("$sectors");e&&(t.each(e,function(t){t.destroy()}),this.set("$sectors",null))}}),o.getSizeOf=i.getSizeOf,o},{requires:["gallery/kcharts/1.2/piechart/util","gallery/kcharts/1.2/piechart/sector","gallery/kcharts/1.2/piechart/animation","gallery/kcharts/1.2/piechart/label","gallery/kcharts/1.1/raphael/index","gallery/kcharts/1.1/tools/color/index"]});