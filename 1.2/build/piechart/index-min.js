KISSY.add("gallery/kcharts/1.2/piechart/animation",function(t,e){function r(e,r,o){function h(){y||(f=+new Date,k=!0)}function l(){var t=+new Date;_=_+t-f,k=!1}o||(o={}),o=t.merge(i,o);var c,u,f,d=+new Date,p=(d+o.duration,d),g=o.duration,v=n[o.easing],m=o.frame||t.noop,x={},y=!1,b=o.duration,w=0,_=0,k=!1;for(var C in e)r[C]||r[C]==0?x[C]=null:delete e[C];c=function(){var i,n;if(n=w/g,i=v(n),t.isArray(e))for(var s=0,h=e.length;h>s;s++)x[s]=e[s]+(r[s]-e[s])*i;else for(var l in e)x[l]=e[l]+(r[l]-e[l])*i;b>w?(m.call(T,x,n),u=a(c)):(m.call(T,r,1),y=!0,o.endframe&&o.endframe.call(T,r,1)),p=+new Date,w=p-d-_};var T={stop:function(){s(u)},resume:function(){k&&(l(),c())},pause:function(){k||(h(),s(u))},isRunning:function(){return!y}};return c(),T}var i,n=e.Easing,a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)},s=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;return i={duration:1e3,easing:"easeNone"},r.AnimateObject=function(e,i){var n=[],a=0,s={},o={},h=e.length;t.each(e,function(t,e){var r,i=t.from,h=t.to;for(var l in i)r=a++,n[r]=[t,l,e],s[r]=i[l],o[r]=h[l]});var l=r(s,o,{easing:i.easing,duration:i.duration,frame:function(t){for(var e in t){var r=n,i=r[e][0],a=r[e][1],s=r[e][2],o=i.from;o[a]=t[e],i.frame&&i.frame(a,t[e],t,s,h)}},endframe:function(t){for(var e in t){var r=n,a=r[e][0],s=r[e][1],o=r[e][2];a.endframe&&a.endframe(s,t[e],o,t)}i.endframe&&i.endframe()}});return l},r},{requires:["anim"]}),KISSY.add("gallery/kcharts/1.2/piechart/label",function(t){function e(t,e){var r,i,n,a;return r=t[0],n=t[1],i=e[0],a=e[1],Math.sqrt(Math.pow(r-i,2)+Math.pow(n-a,2))}function r(t,r,i){function n(t,a,s,o){if(i>=t.length)return{min:s,left:o};if(a>e(r,t[0])){var h=t.slice(1);return n(h,e(r,t[0]),t[0],h)}return n(t.slice(1),a,s,o)}return n(t,1/0,t[0],[])}function i(t,e){function i(t,e,n){if(t.length==0)return n;var a=r(e,t[0],t.length-1);return n.push(a.min),i(t.slice(1),a.left,n)}return i(t,e,[])}function n(e){return o||(o=t.Node("<div/>").css({visibility:"hidden",position:"fixed",left:"-9999em",top:0}).appendTo(document.body)),o.html(e),{width:h.width(o),height:h.height(o)}}function a(t){this.set(t),this.init()}function s(e,r,s){var o,h,l,c,u,f,d,p=e.get("paper"),g=(e.get("container"),r.length,[]),v=[],m=[],x=e.get("cx"),y=e.get("cy"),b=e.get("rs"),w=e.get("padding")||20,_=w+10,k=(Math.cos,Math.sin,Math.asin,Math.PI,Math.PI/180);if(this.labels=[],d=r[0]){for(o=n(d.get("label")).height,c=Math.max.apply(Math,b),u=c+w,f=c+_,h=y-f,l=y+f,h+=o;l-o>h;h+=o){var C=h,T=Math.asin((C-y)/f),S=x+f*Math.cos(T);S=s?2*x-S:S,g.push([S,C])}r.length>g.length&&(r=r.sort(function(t,e){var r=Math.abs(t.get("start")-t.get("end")),i=Math.abs(e.get("start")-e.get("end"));return r>i?-1:i>r?1:0}),r=r.slice(0,g.length)),r=r.sort(function(t,e){var r=t.get("middley"),i=e.get("middley");return i>r?1:r>i?-1:0}),Math.PI/180,t.each(r,function(t){var e,r,i=n=t.get("middlex"),n=t.get("middley"),a=t.get("middleangle")*k;e=x+u*Math.cos(-a),r=y+u*Math.sin(-a),m.push([e,r]),v.push([i,n])}),v=v.reverse(),m=m.reverse(),r=r.reverse();for(var B=i(v,g),A=0,E=B.length;E>A;A++){var M,L,F,R,N=v[A],D=B[A];M=N[0],F=N[1],L=D[0],R=D[1];var I,z;I=m[A][0],z=m[A][1];var P,O=R;P=s?L-10:L+10;var j,$,V=p.path(["M",M,F,"Q",I,z,P,O].join(",")),q=r[A],H=e.get("sizefn"),U=q.get("label"),Y=n(U),W=this,X=q.get("$path").attr("fill"),G=e.get("autoLabelPathColor");V&&V.toBack&&V.toBack(),"undefined"!=G&&V.attr("stroke",X),H&&t.isFunction(H)&&(Y=H(Y,q,e)),s?(j=P-Y.width,$=O-Y.height/2):(j=P,$=O-Y.height/2);var K=t.Node("<div class='kcharts-label'>"+U+"</div>"),Z=new a({label:K,sector:q,$path:V,x:j,y:$,size:Y,pie:e}),Q=Z.get("el"),J=function(t,e,r){t.on("click",function(t){W.fire("click",{el:t.currentTarget,label:r,sector:e})})};J(Q,q,Z),W.labels.push(Z)}}}var o,h=t.DOM;return t.extend(a,t.Base,{init:function(){var t=this.get("label"),e=this.get("x"),r=this.get("y"),i=this.get("size"),n=this.get("pie"),a=(this.get("sector"),n.get("container"));t.css({position:"absolute",left:e+"px",top:r+"px",width:i.width+"px",height:i.height+"px"}).appendTo(a),this.set("el",t)},destroy:function(){this.get("el").remove(),this.get("$path").remove()}}),t.extend(s,t.Base,{destroy:function(){t.each(this.labels,function(t){t.destroy()})}}),s.getSizeOf=n,s}),KISSY.add("gallery/kcharts/1.2/piechart/legend",function(t){function e(){this.bindEvent()}t.extend(e,t.Base,{init:function(){},bindEvent:function(){},alignBottom:function(){},alignTop:function(){},alignLeft:function(){},alignRight:function(){}})}),KISSY.add("gallery/kcharts/1.2/piechart/sector",function(t){function e(t,e,r,i,n){Math.abs(i-n)>=360&&(n+=.01),i==n&&(n-=.1);var a,s=Math.PI/180,o=(i+n)/2,h=t+r*Math.cos(-o*s),l=t+r*Math.cos(-o*s)*.5,c=t+r*Math.cos(-i*s),u=t+r*Math.cos(-n*s),f=e+r*Math.sin(-o*s),d=e+r*Math.sin(-o*s)*.5,p=e+r*Math.sin(-i*s),g=e+r*Math.sin(-n*s),v=+(Math.abs(i-n)>180),m=1;return a=["M",t,e,"L",c,p,"A",r,r,0,v,m,u,g,"z"],a.middleangle=o,a.middlex=h,a.middley=f,a.cx=l,a.cy=d,a.A=[c,p],a.B=[u,g],a}function r(t,e,r,i,n,a){Math.abs(n-a)>=360&&(a+=.01),n==a&&(a-=.1);var s=Math.PI/180,o=(n+a)/2,h=t+i*Math.cos(-o*s),l=t+.5*(r+i)*Math.cos(-o*s)*.5,c=(t+r*Math.cos(-o*s),t+r*Math.cos(-n*s)),u=t+r*Math.cos(-a*s),f=t+i*Math.cos(-n*s),d=t+i*Math.cos(-a*s),p=e+i*Math.sin(-o*s),g=e+.5*(r+i)*Math.sin(-o*s)*.5,v=(e+r*Math.sin(-o*s),e+r*Math.sin(-n*s)),m=e+r*Math.sin(-a*s),x=e+i*Math.sin(-n*s),y=e+i*Math.sin(-a*s),b=["M",f,x,"L",c,v,"A",r,r,0,+(Math.abs(a-n)>180),1,u,m,"L",d,y,"A",i,i,0,+(Math.abs(a-n)>180),0,f,x];return b.middleangle=o,b.middlex=h,b.middley=p,b.cx=l,b.cy=g,b.A=[c,v],b.B=[f,x],b.C=[u,m],b.D=[d,y],b}function i(t,e,r,n,a,s,o,h){return this instanceof i?(this.set({cx:e,cy:r,r:n,start:a,end:s,pathcfg:o,paper:t,framedata:h}),this.draw(),this.bindEvent(),this):new i(t,e,r,n,a,s,o)}return t.extend(i,t.Base,{bindEvent:function(){this.on("afterCxChange",function(){this.draw()}),this.on("afterCyChange",function(){this.draw()}),this.on("afterStartChange",function(){this.draw()}),this.on("afterEndChange",function(){this.draw()}),this.on("afterRChange",function(){this.draw()});var t=this.get("$path"),e=this;t.click(function(){e.fire("click")}),t.mouseout(function(){e.fire("mouseout")}),t.mouseover(function(){e.fire("mouseover")})},unbindEvent:function(){this.detach();var t=this.get("$path");t.unclick(),t.unmouseover(),t.unmouseout()},_syncAttrFromPath:function(t){this.set({middleangle:t.middleangle,sectorcx:t.cx,sectorcy:t.cy,middlex:t.middlex,middley:t.middley,centerpoint:t.cc,A:t.A,B:t.B})},draw:function(){var e=this.get("r"),r=this.get("paper"),i=this.get("pathcfg"),n=this.get("framedata"),a=n&&n.sectorcfg||{},s=r.path();i=t.merge({stroke:"#fff"},i),a&&(i=t.merge(i,{stroke:a.stroke,"stroke-width":a.strokeWidth})),s.attr(i),this.set("$path",s),t.isArray(e)&&e.length==2?this._drawDonut():this._drawSector()},_drawSector:function(){var t,r=this.get("cx"),i=this.get("cy"),n=this.get("r"),a=this.get("start"),s=this.get("end"),o=e(r,i,n,a,s),h=o.join(",");return this.get("paper"),t=this.get("$path"),t.attr("path",h),this._syncAttrFromPath(o),this.draw=this._drawSector,this},_drawDonut:function(){var t,e=this.get("cx"),i=this.get("cy"),n=this.get("r"),a=this.get("start"),s=this.get("end"),o=r(e,i,n[0],n[1],a,s),h=o.join(",");return this.get("paper"),t=this.get("$path"),t.attr("path",h),this._syncAttrFromPath(o),this.draw=this._drawDonut,this},destroy:function(){this.unbindEvent(),this.get("$path").remove()}}),i}),KISSY.add("gallery/kcharts/1.2/piechart/util",function(t,e,r,i){function n(t){function e(t){for(var a=0,s=t.length;s>a;a++)i.call(t[a])==n?e(t[a]):r.push(t[a])}var r=[],i=Object.prototype.toString,n=i.call(t);return e(t),r}function a(e,r){function i(e,a){for(var s=0,o=e.length;o>s;s++)t.isArray(e[s])?i(e[s],a++):r(e[s])&&(n[a]||(n[a]=[]),n[a].push(e[s]))}var n=[];return i(e,0),n}function s(e,r){function i(e,n){for(var o=0,h=e.length;h>o;o++)if(t.isArray(e[o].data)){var l=n.push(t.mix({},e[o],!0,["label"]));n[l].data=[],i(e[o].data,n[l].data)}else{var c=e[o].data,u=c/s;r(c,u)?n.push(e[o]):a+=e[o].data}}var n=[],a=0,s=c(e);return i(e,n),n.push({label:"\u5176\u5b83",data:a}),n}function o(t){function e(t){for(var r,i=[],n=0,a=t.length;a>n;n++)typeof t[n].data=="object"&&i.push(1+e(t[n].data));return r=i.length?Math.max.apply(null,i):0}var r=e(t);return r+1}function h(t,e){for(var r=0,i=0,n=t.length;n>i;i++){var a=e(t[i]);a&&(r+=a)}return r}function l(e){return h(e,function(e){return e.value&&t.isNumber(e.value)?e.value:0})}function c(e){for(var r=0,i=0,n=e.length;n>i;i++)r+=t.isArray(e[i].data)?c(e[i].data):e[i].data;return r}function u(t){function e(t,a,s){for(var o=0,h=t.length;h>o;o++){var l;if(l=s?s:o+1,_(t[o].data)){var u=c(t[o].data);t[o].value=u,i[a]||(i[a]=[]),i[a].push(t[o]),n[l-1]||(n[l-1]=[]),n[l-1].push(t[o]),e(t[o].data,a+1,l)}else{if(t[o].value=t[o].data,i[a]||(i[a]=[]),i[a].push(t[o]),r-1>a){var f=a+1;for(t[o].crossdepth=a;r>f;)i[f]||(i[f]=[]),i[f].push(t[o]),f++}n[l-1]||(n[l-1]=[]),n[l-1].push(t[o])}}}var r,i=[],n=[],a={};return r=o(t),e(t,0),a.groups=i,a.set=n,a}function f(t,e){var r,i=this.el.get("start"),n=this.prev,a=this.el.get("donutIndex");a&&(i=n.el.get("end")),r=i-e,this.el.set("start",i),this.el.set("end",r)}function d(t,r){var i=r.get("rs"),n=[],a=r.get("interval")||2,s=r.get("paper"),o=r.get("cx"),h=r.get("cy"),c=r.get("pathcfg"),u=!!r.get("donut"),d=r.get("initdeg");void 0==d&&(d=90);for(var p=0,g=t.length;g>p;p++)for(var v=s.set(),m=l(t[p]),x=0,y=0,b=t[p].length;b>y;y++){var w,_,k=t[p],C=k[y],T=typeof C.crossdepth=="number";if(!(T&&g-1>p)){w=p?T?C.crossdepth==0?[i[p]]:[i[C.crossdepth-1]+a,i[p]]:[i[p-1]+a,i[p]]:i[p],u&&1==g&&(w=[i[0],i[1]]),C.el=new e(s,o,h,w,d,d-1,c,C),_=C.el.get("$path"),v.push(_),C.el.set("group",v),C.el.set("groupLength",g),C.el.set("framedata",C);var S=[];if(T)for(var B=C.crossdepth;g>B;)S.push(B),B++;else S.push(p);C.el.set("groupIndex",S),C.el.set("donutIndex",y),C.el.set("label",C.label||""),n.push(C.el),function(t){C.el.on("mouseout",function(){r.fire("mouseout",{sector:t})}),C.el.on("mouseover",function(){r.fire("mouseover",{sector:t})}),C.el.on("click",function(){r.fire("click",{sector:t})})}(C.el),C.frame=f,C.from||(C.from={}),C.to||(C.to={}),C.percent=C.value/m,C.from.deg=0,C.to.deg=y==b-1?360-x:C.percent*360,x+=C.percent*360,C.prev=y>0?k[y-1]:k[b-1],C.next=b-1>y?k[y+1]:k[0]}}return n}function p(t,e){for(var r=e.get("paper"),i=0,n=t.length;n>i;i++)for(var a=r.set(),s=0,o=t[i].length;o>s;s++){var h=t[i][s],l=h.el,c=l.get("$path");a.push(c),l.set("set",a)}}function g(t){var e;return(!t||0>t||t>1)&&(e=.1),e}function v(t,e,r){if(r||(r=0),t){this.color=t;var n,a,s,o,h,l=i.getRGB(t);n=i.rgb2hsb(l),a=n.h,s=n.s,o=n.b,h=(s-r)/e,this.step=h,this.h=a,this.s=s,this.b=o}}function m(t,e,n){for(var a=e.get("paper"),s=e.get("color"),o=new r,h=s&&s.initial,l=h&&i.getRGB(h),c=s&&g(s.min),u=new v(l,n,c),f=0,d=l,p=e.get("gradient"),m=0,x=t.length;x>m;m++)for(var y=(a.set(),t[m][0].color),b=t[m].length,w=new v(y,b),_=0,k=t[m].length;k>_;_++){var C,T=t[m][_],S=T.el,B=S.get("framedata"),A=S.get("$path");if(T.color)C=T.color;else{var E;if(E=w.getColor())C=E;else{var M=u.getColor();C=M?M:o.getColor(m+_).DEFAULT}}A.attr("fill",C);var L=B.gradientcolor||d;p&&A.attr("gradient",f+B.to.deg/2+"-"+L+"-"+C),f+=B.to.deg,d=C}}function x(e){e=a(e,function(t){var e=t.el.get("$path");return t.hide?(e.hide(),!1):(e.show(),!0)});for(var r=0,i=e.length;i>r;r++)for(var n=e[r],s=h(n,function(e){return e.value&&!e.hide&&t.isNumber(e.value)?e.value:0}),o=0,l=0,c=n.length;c>l;l++){var u=n[l];u.el.get("$path"),u.percent=u.value/s,u.to.deg=l==c-1?360-o:u.percent*360,o+=u.percent*360,u.prev=l>0?n[l-1]:n[c-1],u.next=c-1>l?n[l+1]:n[0]}}function y(t){for(t%=360;0>t;)t+=360;return t>=0&&90>=t||t>270&&360>=t?!0:!1}function b(t){var e=u(t.get("data")),r=d(e.groups,t);t.get("color"),t.get("hsb");var i=n(e.groups);return p(e.set,t),m(e.set,t,i.length),{$sectors:r,groups:e.groups,set:e.set,framedata:i}}function w(t,e,r){return r||(r=5),Math.abs(t-e)<r}var _=t.isArray;v.prototype.getColor=function(){var t;return this.color&&(t="hsb("+[this.h,this.s-=this.step,this.b].join(",")+")"),t};var k={initPath:b,fillColor:m,adjustFrameData:x,isRightAngel:y,filterdata:s,closeto:w};return k},{requires:["gallery/kcharts/1.2/piechart/sector","gallery/kcharts/1.1/tools/color/index","gallery/kcharts/1.1/raphael/index"]}),KISSY.add("gallery/kcharts/1.2/piechart/index",function(t,e,r,i,n,a){function s(){this.destroy();var t=a(this.get("container"),this.get("width"),this.get("height"));this.set("paper",t),this.initPath(),this.fire("beforeRender");var e=this.get("framedata");this.animate(e)}function o(e){var r,i=this.get("width"),n=this.get("height"),a=Math.min(i,n),s=e.rpadding;e.rs||(s||(s=40,this.set("rpadding",s)),r=a>s?a-s:a,e.rs=[r/2]),t.isNumber(e.cx)||(e.cx=i/2),t.isNumber(e.cy)||(e.cy=n/2),t.isNumber(e.repaintRate)||(e.repaintRate=200),e.donut&&(e.donutSize||(e.donutSize=30),e.donutSize>e.rs[0]&&(e.donutSize=e.rs[0]/2),e.rs[1]=e.rs[0]-e.donutSize)}function h(e){var r=t.get(e.renderTo),i=l.width(r),n=l.height(r),s=a(r),o=l.css(r,"position")=="static"?!0:!1;if(this.set({paper:s,width:i,height:n,container:r}),this._setupcfg(e),t.isArray(e.rs)||(e.rs=[e.rs]),o&&l.css(r,"position","relative"),this.set(e),this.adjustCfg(),this.adjustData(),e.autoRender!=0){var h=this;setTimeout(function(){h.render()},0)}}var l=t.DOM,c=t.Event;return t.extend(h,t.Base,{bindEvent:function(){this.on("afterCxChange",function(){this.render()}),this.on("afterCyChange",function(){this.render()}),this.on("afterRsChange",function(){this.render()}),this.on("afterDataChange",function(){this.render()}),c.on(this.get("container"),"mouseleave",function(){this.fire("mouseleave")},this)},_setupcfg:o,adjustCfg:function(){var e=this.get("anim"),r=this,i=t.isFunction(e.endframe)&&e.endframe,n=r.get("label");e.endframe=function(){0!=n&&r.drawLabel(n),i&&i.call(r),r.fire("afterRender")}},adjustData:function(){var r=this.get("filterfn");if(r&&t.isFunction(r)){var i,n=this.get("data");i=e.filterdata(n,r),this.set("data",i)}},initPath:function(){var t=e.initPath(this);this.set("$sectors",t.$sectors),this.set("groups",t.groups),this.set("set",t.set),this.set("framedata",t.framedata)},render:function(){this.initPath(),this.fire("beforeRender");var e=this.get("framedata");this.animate(e);var r=t.buffer(s,this.get("repaintRate"),this);this.render=r,this.bindEvent()},adjust:function(){var r=this.get("groups").slice(0),i=this.get("framedata");i=t.filter(i,function(t){return!t.hide}),e.adjustFrameData(r,this),this.animate(i)},autoResize:function(){var t,r=this.get("container"),i=l.width(r),n=l.height(r),a=Math.min(i,n),s=this.get("rpadding"),o=this.get("cx"),h=this.get("cy"),c=i/2,u=n/2,f={width:i,height:n};this.set(f),e.closeto(c,o)||this.set("cx",c),e.closeto(u,h)||this.set("cy",u),t=a>s?a-s:a;var d,p,g=this.get("donut"),v=this.get("donutSize");if(g)d=t/2,p=v>d?d/2:d-v,this.set("rs",[d,p]);else{var m=this.get("rs");m.length==1&&this.set("rs",[t/2])}},animate:function(t){var e=this,r=this.get("anim");this.isRunning()&&this.stop(),e.fire("beginRender"),this.animateInstance=i.AnimateObject(t,r)},drawLabel:function(){var r,i,a=[],s=[],o=this.get("$sectors");t.each(o,function(r){var i=r.get("middleangle"),n=r.get("groupLength"),o=r.get("groupIndex"),h=e.isRightAngel(i);t.indexOf(n-1,o)>-1?h?s.push(r):(r.set("isleft",!0),a.push(r)):h?r.set("isright",!0):r.set("isleft",!0)}),r=new n(this,a,!0),i=new n(this,s,!1),r.on("click",this.onLabelClick,this),i.on("click",this.onLabelClick,this),this.set("$labels",[].concat(r,i))},drawSetLabel:function(){},onLabelClick:function(t){this.fire("labelclick",{el:t.el,label:t.label,sector:t.sector})},isRunning:function(){return this.animateInstance&&this.animateInstance.isRunning()},stop:function(){this.animateInstance&&(this.animateInstance.stop(),delete this.animateInstance)},destroy:function(){var e=this.get("$sectors"),r=this.get("$labels"),i=[].concat(e,r);t.each(i,function(t){t&&t.destroy()}),this.set("$sectors",null),this.set("$labels",null),this.get("paper").remove()}}),h.getSizeOf=n.getSizeOf,h},{requires:["gallery/kcharts/1.2/piechart/util","gallery/kcharts/1.2/piechart/sector","gallery/kcharts/1.2/piechart/animation","gallery/kcharts/1.2/piechart/label","gallery/kcharts/1.1/raphael/index","gallery/kcharts/1.1/tools/color/index"]});