/*! kcharts - v1.2 - 2013-08-27 3:46:39 PM
* Copyright (c) 2013 数据可视化小组; Licensed  */
KISSY.add("gallery/kcharts/1.2/barchart/theme",function(){var e={"ks-chart-default":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},tip:{css:{border:"1px solid {COLOR}"}}},"ks-chart-analytiks":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},tip:{css:{border:"1px solid {COLOR}"}}},"ks-chart-rainbow":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},tip:{css:{border:"1px solid {COLOR}"}}}};return e}),KISSY.add("gallery/kcharts/1.2/barchart/index",function(e,t,r,a,n,i,s,o,l){var c,d=e.all,h=e.Event,f="ks-chart-",p=f+"default",_=p+"-canvas",u=f+"evtlayout",g=u+"-bars",b="{COLOR}",x=function(e){this.init(e)};return e.extend(x,r,{init:function(t){var n=this;if(n.chartType="barchart",r.prototype.init.call(n,t),n._$ctnNode[0]){var i={themeCls:p,autoRender:!0,colors:[],stackable:!1,title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:!0},xLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},yLabels:{isShow:!0,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},xAxis:{isShow:!0,css:{color:"#eee",zIndex:10},min:0},yAxis:{isShow:!0,css:{zIndex:10},num:5,min:0},xGrids:{isShow:!0,css:{}},yGrids:{isShow:!0,css:{}},areas:{isShow:!0,css:{}},bars:{isShow:!0,css:{background:b,border:"1px solid #fff"},barsRatio:.6,barRatio:.5},legend:{isShow:!1},tip:{isShow:!0,template:"",css:{},anim:{easing:"easeOut",duration:.3},offset:{x:0,y:0},boundryDetect:!0,alignX:"right",alignY:"bottom"}};n._bars={},n._finished=[],p=n._cfg.themeCls||i.themeCls,n._cfg=e.mix(e.mix(i,s[p],o,o,!0),n._cfg,o,o,!0),n.color=c=new a({themeCls:p}),n._cfg.colors.length>0&&c.removeAllColors();for(var l in n._cfg.colors)c.setColor(n._cfg.colors[l]);n._cfg.autoRender&&n.render(!0)}},drawTitle:function(){var t=this,r=t.paper,a=p+"-title",n=t._cfg,i=t._innerContainer,s=.6*i.y;!t._title&&n.title.isShow&&""!=n.title.content&&(t._title=r.rect(0,0,t._$ctnNode.width(),s).addClass(a).css(e.mix({"line-height":s+"px"},n.title.css))),t._title&&""!=n.title.content&&t._title.html(n.title.content)},drawSubTitle:function(){var t=this,r=t.paper,a=p+"-subtitle",n=t._cfg,i=t._innerContainer,s=.4*i.y;!t._subTitle&&n.subTitle.isShow&&""!=n.subTitle.content&&(t._subTitle=r.rect(0,.6*i.y,t._$ctnNode.width(),s).addClass(a).css(e.mix({"line-height":s+"px"},n.subTitle.css))),t._subTitle&&""!=n.subTitle.content&&t._subTitle.html(n.subTitle.content)},drawBar:function(t,a,n){var i,s=this,o=s._cfg,l=s.paper,c=_+"-bars",d=s._innerContainer,h=s.color._colors[t].DEFAULT,f=s.processAttr(o.bars.css,h),p="x"==o.zoomType?!1:!0,u=s._barsPos[t][a],g=(u.x-0).toFixed(2),b=(u.y-0).toFixed(2),x=(u.width-0).toFixed(2),m=(u.height-0).toFixed(2);if(o.anim){var v=o.anim.duration?e.isNumber(o.anim.duration)?o.anim.duration:.5:.5,w=o.anim.easing?o.anim.easing:"easeOut";if(p){var y=r.prototype.data2GrapicData.call(s,0,!0,!1);i=l.rect(y,b,0,m).attr({posx:g,posy:b}).addClass(c).css(f).animate({width:x,marginLeft:g-d.x},v,w,function(){n&&n()})}else{var C=r.prototype.data2GrapicData.call(s,0,!1,!0);i=l.rect(g,C,x,0).attr({posx:g,posy:b}).addClass(c).css(f).animate({height:m,marginTop:b-d.y},v,w,function(){n&&n()})}}else i=l.rect(g,b,x,m).attr({posx:g,posy:b}).addClass(c).css(f),n&&n();return i},getBarsPos:function(){var e=this,t=e._cfg.zoomType,a=e._cfg.stackable,n=e._innerContainer,i="y"==t,s=a?1:r.prototype.obj2Array(e._clonePoints).length,o=e._cfg.bars.barsRatio,l=e._cfg.bars.barRatio,c=i?e._pointsY.length>1?e._pointsY[1].y-e._pointsY[0].y:n.height:e._pointsX.length>1?e._pointsX[1].x-e._pointsX[0].x:n.width,d=c*o,h=l>=1?0:(1-l)/l,f=d/(s+(s-1)*h),p=f*(1-l)/l,_=a?0:f+p,u=(e._innerContainer.bl.y,e._innerContainer.bl.x),g=(c*(1-o)-c)/2,b=[];e._barsPos={};for(var x in e._points){var m=[];if(i){var v=r.prototype.data2GrapicData.call(e,0,!0,!1);for(var w in e._points[x]){var y={},C=e._points[x][w].x,L=Math.abs(C-v);y.y=g+e._points[x][w].y,a?(y.x=u+(b[w]||0),b[w]=b[w]?b[w]+L:L):y.x=C>v?C-L:v-L,y.width=L,y.height=f,m.push(y)}}else{var A=r.prototype.data2GrapicData.call(e,0,!1,!0);for(var w in e._points[x]){var y={},T=e._points[x][w].y,Y=Math.abs(A-T);y.x=g+e._points[x][w].x,a?(y.y=T-(b[w]||0),b[w]=b[w]?b[w]+Y:Y):y.y=T>A?A:T,y.width=f,y.height=Y,m.push(y)}}g+=_,e._barsPos[x]=m}},drawBars:function(e){var t=this;t._cfg;for(var r in t._barsPos){var a=[],n=[];for(var i in t._barsPos[r]){var s=t._barsPos[r][i];n[i]=s,a[i]=t.drawBar(r,i,function(){t._finished.push(!0),e&&t._finished.length==t._cfg.series.length&&e()}).attr({barGroup:r,barIndex:i,defaultColor:c.getColor(r).DEFAULT,hoverColor:c.getColor(r).HOVER})}var o={bars:a,posInfos:n,color:c.getColor(r)};t._bars[r]=o}return t._bars},drawGridsX:function(){var e,t=this,r=t._points[0];if(t._gridsX=[],"x"==t._cfg.zoomType){e=function(){var e=r.length,t=[];if(e>1){var a=(r[1].x-r[0].x)/2;t.push({x:r[0].x-a});for(var n in r)t.push({x:r[n].x- -a})}return t}();for(var a=0,n=e.length;n>a;a++)t._gridsX.push(t.drawGridX(e[a]))}else for(var a in t._pointsX)t._gridsX.push(t.drawGridX(t._pointsX[a]));return t._gridsX},drawGridX:function(e,t){var r=this,a=r._innerContainer.tl.y,n=r._innerContainer.height,t=t||r._cfg.xAxis.css,i=r.htmlPaper,s=r._cfg.themeCls+"-gridsx";return i.lineY(e.x,a,n).addClass(s).css(r._cfg.xGrids.css)},drawGridY:function(e,t){var r=this,a=r._innerContainer.width,t=t||r._cfg.yGrids.css,n=r.htmlPaper,i=r._cfg.themeCls+"-gridsy";return n.lineX(e.x,e.y,a).addClass(i).css(t)},drawGridsY:function(){var e=this,t=e._innerContainer.tl.x,r="x"==e._cfg.zoomType?!1:!0;e._gridsY=[];for(var a=0,n=e._pointsY.length;n>a;a++)e._gridsY[a]={0:e.drawGridY({x:t,y:e._pointsY[a].y}),num:r?e.coordNumX[a]:e.coordNum[a]}},drawAxisX:function(){var e=this,t=e._innerContainer,r=t.bl,a=t.width,n=e.htmlPaper,i=e._cfg.themeCls+"-axisx";return e._axisX=n.lineX(r.x,r.y,a).addClass(i).css(e._cfg.xAxis.css||{}),e._axisX},drawAxisY:function(){var e=this,t=e._innerContainer,r=t.tl,a=t.height,n=e.htmlPaper,i=e._cfg.themeCls+"-axisy";return e._axisY=n.lineY(r.x,r.y,a).addClass(i).css(e._cfg.yAxis.css||{}),e._axisY},drawLabelsX:function(){var e=this,t=e._cfg,r="y"==t.zoomType?!0:!1;if(r)for(var a in e._pointsX)e._labelX[a]={0:e.drawLabelX(a,e._pointsX[a].number)};else for(var a in e._cfg.xAxis.text)e._labelX[a]={0:e.drawLabelX(a,e._cfg.xAxis.text[a])}},drawLabelsY:function(){var e=this,t=e._cfg,r="x"==t.zoomType?!1:!0;if(r)for(var a in e._cfg.yAxis.text)e._labelY[a]={0:e.drawLabelY(a,e._cfg.yAxis.text[a])};else for(var a in e._pointsY)e._labelY[a]={0:e.drawLabelY(a,e._pointsY[a].number),num:e._pointsY[a].number}},drawLabelX:function(r,a){var n,i=this,s=i.htmlPaper,l=i._pointsX,c=l.length||0,d=i._cfg.themeCls+"-xlabels",h="{{data}}",f="";return c>r?(h=i._cfg.xLabels.template||h,f=e.isFunction(h)?h(r,a):t(h).render({data:a}),n=l[r],n[0]=s.text(n.x,n.y,"<span class="+d+">"+f+"</span>","center").children().css(i._cfg.xLabels.css),n[0]):o},drawLabelY:function(r,a){var n=this,i=n.htmlPaper,s=n._cfg.themeCls+"-ylabels",o="{{data}}",l="";return o=n._cfg.yLabels.template||o,l=e.isFunction(o)?o(r,a):t(o).render({data:a}),l&&i.text(n._pointsY[r].x,n._pointsY[r].y,"<span class="+s+">"+l+"</span>","right","middle").children().css(n._cfg.yLabels.css)},renderTip:function(){var t=this,r=t._cfg,a=t._innerContainer,n=r.tip.boundryDetect?{x:a.tl.x,y:a.tl.y,width:a.width,height:a.height}:{},i=e.mix(r.tip,{rootNode:t._$ctnNode,clsName:r.themeCls,boundry:n});return t.tip=new l(i),t.tip},renderEvtLayout:function(){var e,t=this,r=t._innerContainer,a=(r.tl.y,t._points[0],r.height);t._multiple,t._evtEls._bars=[],e=t._evtEls.paper?t._evtEls.paper:t._evtEls.paper=new n(t._$ctnNode,{clsName:u,prependTo:!1,width:r.width,height:a,left:r.tl.x,top:r.tl.y,css:{"z-index":20,background:"#fff",filter:"alpha(opacity =1)","-moz-opacity":.01,"-khtml-opacity":.01,opacity:.01}});for(var i in t._barsPos){var s=[];for(var o in t._barsPos[i]){var l=t._barsPos[i][o];s[o]=e.rect(l.x,l.y,l.width,l.height).addClass(g).attr({barGroup:i,barIndex:o})}t._evtEls._bars.push(s)}return e},clearEvtLayout:function(){var e=this;if(e._evtEls._bars)for(var t in e._evtEls._bars)for(var r in e._evtEls._bars[t])e._evtEls._bars[t][r].remove()},renderLegend:function(){var t=this,r=t._cfg.legend,a=r.container&&d(r.container)[0]?d(r.container):t._$ctnNode,n=t._innerContainer,s=t.color._colors,o=s.length,l=t._cfg,c=t._cfg.series,h=e.map(c,function(e,t){t%=o;var r={},a=s[t];return r.text=e.text,r.DEFAULT=a.DEFAULT,r.HOVER=a.HOVER,r}),f=e.merge({interval:20,iconright:5,showicon:!0},l.legend.globalConfig);return t.legend=new i({container:a,bbox:{width:n.width,height:n.height,left:n.x,top:n.y},align:l.legend.align||"bc",offset:l.legend.offset||(/t/g.test(l.legend.align)?[0,0]:[0,20]),globalConfig:f,config:h}),t.legend.on("click",function(e){var t=e.index,r=(e.text,e.icon,e.el);1!=r.hide?(this.hideBar(t),r.hide=1,r.disable()):(this.showBar(t),r.hide=0,r.enable())},this),t.legend},render:function(t){var r=this,a=r._cfg,i=r._innerContainer,s=a.themeCls;t&&r._$ctnNode.html(""),r.paper=new n(r._$ctnNode,{clsName:_,width:i.width,height:i.height,left:i.tl.x,top:i.tl.y}),r._clonePoints=r._points,r.getBarsPos(),r.htmlPaper=new n(r._$ctnNode,{clsName:s}),r.drawTitle(),r.drawSubTitle(),r.renderEvtLayout(),a.tip.isShow&&r.renderTip(),a.xGrids.isShow&&r.drawGridsX(),a.yGrids.isShow&&r.drawGridsY(),a.xAxis.isShow&&r.drawAxisX(),a.yAxis.isShow&&r.drawAxisY(),a.xLabels.isShow&&r.drawLabelsX(),a.yLabels.isShow&&r.drawLabelsY(),a.legend.isShow&&r.renderLegend(),r.drawBars(function(){e.log("finished"),r.afterRender()}),r.bindEvt(),e.log(r)},bindEvt:function(){var e=this,t=e._cfg;h.detach(d("."+g,e._$ctnNode),"mouseenter"),h.on(d("."+g,e._$ctnNode),"mouseenter",function(r){var a=d(r.currentTarget),n=a.attr("barIndex"),i=a.attr("barGroup");t.tip.isShow&&e.tipHandler(i,n),e.barChange(i,n)}),h.detach(d("."+g,e._$ctnNode),"mouseleave"),h.on(d("."+g,e._$ctnNode),"mouseleave",function(t){var r=d(t.currentTarget),a=r.attr("barIndex"),n=r.attr("barGroup"),i=e._bars[n].bars[a];i.css({background:i.attr("defaultColor")})}),h.detach(e._evtEls.paper.$paper,"mouseleave"),h.on(e._evtEls.paper.$paper,"mouseleave",function(){e.tip&&e.tip.hide(),e.paperLeave()})},paperLeave:function(){var e=this;e.fire("paperLeave",e)},barChange:function(t,r){var a=this,n=a._bars[t],i=e.mix({target:n.bars[r],currentTarget:n.bars[r],barGroup:Math.round(t),barIndex:Math.round(r)},a._points[t][r]);a.fire("barChange",i)},tipHandler:function(t,r){var a=this,n=a._cfg,i=a.tip,s="y"==n.zoomType?!0:!1,o=(i.getInstance(),a._bars[t].bars[r]),l=o.attr("defaultColor"),c=a._cfg.tip.template,d=s?o.attr("posx")- -o.width()- -a._innerContainer.x:o.attr("posx"),h=o.attr("posy"),f=e.merge(a._points[t][r].dataInfo,n.series[t]);delete f.data,a._points[t][r].dataInfo,o.css({background:o.attr("hoverColor")}),c&&(i.fire("setcontent",{data:f}),i.fire("move",{x:d,y:h,style:a.processAttr(n.tip.css,l)}))},animateGridsAndLabels:function(){var e=this,t=e._cfg.zoomType;if("y"==t){for(var r in e._labelX)e._labelX[r]&&e._labelX[r][0]&&d(e._labelX[r][0]).remove(),e._gridsX[r]&&e._gridsX[r][0]&&d(e._gridsX[r][0]).remove();e.drawGridsX(),e.drawLabelsX()}else if("x"==t){for(var r in e._labelY)e._labelY[r]&&e._labelY[r][0]&&e._labelY[r][0].remove(),e._gridsY[r]&&e._gridsY[r][0]&&e._gridsY[r][0].remove();e.drawGridsY(),e.drawLabelsY()}},processAttr:function(t,r){var a=e.clone(t);for(var n in a)a[n]&&"string"==typeof a[n]&&(a[n]=a[n].replace(b,r));return a},showBar:function(t){var a=this,n=a._innerContainer;r.prototype.recoveryData.call(a,t),a._clonePoints[t]=a._points[t],a.animateGridsAndLabels(),a.getBarsPos();for(var i in a._bars)if(i!=t)for(var s in a._bars[i].bars)if(a._barsPos[i]){var o=a._barsPos[i][s];o&&a._bars[i].bars[s].stop().animate({height:o.height,width:o.width,marginTop:o.y-n.y,marginLeft:o.x-n.x},.4,"easeOut",function(){}),a._bars[i].bars[s].attr({posx:o.x,posy:o.y})}var l=[],d=[];for(var s in a._barsPos[t]){var o=a._barsPos[t][s];l[s]=o,d[s]=a.drawBar(t,s).attr({barGroup:t,barIndex:s,defaultColor:c.getColor(t).DEFAULT,hoverColor:c.getColor(t).HOVER})}a._bars[t]={bars:d,posInfos:l,color:c.getColor(i)},a.clearEvtLayout(),a.renderEvtLayout(),a.bindEvt(),e.log(a)},hideBar:function(t){var a=this,n=a._innerContainer;r.prototype.removeData.call(a,t),delete a._clonePoints[t],a.animateGridsAndLabels(),a.getBarsPos();for(var i in a._bars[t].bars)a._bars[t].bars[i].remove();for(var i in a._bars)if(i!=t)for(var s in a._bars[i].bars){var o=a._barsPos[i]?a._barsPos[i][s]:"";o&&a._bars[i].bars[s].stop().animate({height:o.height,width:o.width,marginTop:o.y-n.y,marginLeft:o.x-n.x},.4,"easeOut",function(){}),a._bars[i].bars[s].attr({posx:o.x,posy:o.y})}a.clearEvtLayout(),a.renderEvtLayout(),a.bindEvt(),e.log(a)},afterRender:function(){var e=this;e.fire("afterRender",e)},getPaper:function(){return this.paper},clear:function(){return this.paper.clear()}}),x},{requires:["gallery/template/1.0/index","gallery/kcharts/1.2/basechart/index","gallery/kcharts/1.2//tools/color/index","gallery/kcharts/1.2//tools/htmlpaper/index","gallery/kcharts/1.2//legend/index","./theme","gallery/kcharts/1.2//tools/touch/index","gallery/kcharts/1.2//tip/index"]});