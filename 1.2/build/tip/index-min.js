KISSY.add("gallery/kcharts/1.2/tip/index",function(t,e,r,i){function n(e){if(e){var r=this,n={clsName:"ks-chart-default",autoRender:!0,isVisable:!1,boundry:{x:0,y:0,width:0,height:0},rootNode:a("body"),tpl:"",corner:{isShow:!1,tpl:"corner",css:{position:"absolute",marginLeft:0,marginTop:0}},anim:{easing:"easeOut",duration:.25},offset:{x:0,y:0},alignX:"left",alignY:"top"};r._events={MOVE:"move",SETCONT:"setcontent",HIDE:"hide"},r._cfg=t.mix(n,e,i,i,!0),r._cfg.rootNode=a(r._cfg.rootNode),r.init()}}var a=t.all,s=t.DOM;return t.Event,e||(e=t.Base),r||(r=t.Template),t.augment(n,e,{init:function(){var t=this,e=t._cfg;t._data={},t._tpl=e.tpl,t.$tip,t.bindEvent(),e.autoRender&&t.render()},bindEvent:function(){var e=this,r=e._cfg.template,i=e._events;e.on(i.MOVE,function(t){var r=t.x,i=t.y,n=t.style;e.isVisable()&&e._cfg.anim?e.animateTo(r,i):e.moveTo(r,i),n&&e.$tip.css(n)}),e.on(i.SETCONT,function(i){t.isFunction(r)?e.setContent(r(i.data)):e.renderTemplate(r,i.data)}),e.on(i.HIDE,function(){e.hide()})},getInstance:function(){return this.$tip},isVisable:function(){return s.css(this.$tip,"display")=="none"?!1:!0},show:function(){var t=this;return t.$tip&&t.$tip.show(),t},hide:function(){var t=this;return t.$tip&&t.$tip.stop&&t.$tip.stop()&&t.$tip.hide(),t},moveTo:function(t,e){var r=this;r._prevtime=(new Date).getTime(),r.show();var i=r.getInstance(),n=r._cfg,a=(r._cfg.anim,r.getPos(t,e)),s=(n.corner.css["margin-top"]||n.corner.css.marginTop||0,n.corner.css["margin-left"]||n.corner.css.marginLeft||0),o=r.$corner;o&&o.css({"margin-left":s+t-a.x}),i.css({"margin-top":a.y,"margin-left":a.x})},animateTo:function(t,e,r){var i=this,n=i._cfg,a=n.anim,s=(new Date).getTime();i._prevtime&&s-i._prevtime<100&&i.animateFast(t,e,r),i.show(),i._prevtime=(new Date).getTime();var o=i.getInstance(),l=i.getPos(t,e),h=(n.corner.css["margin-top"]||n.corner.css.marginTop||0,n.corner.css["margin-left"]||n.corner.css.marginLeft||0),u=i.$corner;u&&u.css({"margin-left":h+t-l.x}),o.stop().animate({"margin-top":l.y,"margin-left":l.x},a.duration,a.easing,function(){r&&r()})},animateFast:function(t,e,r){var n,a,s=this,o=s.get("x"),l=s.get("y"),h=.2;s._prevtime=(new Date).getTime(),s.show(),o!==i&&(n=o/1+(t-o)*h,a=l/1+(e-l)*h);var u=s.getInstance(),c=s._cfg,f=s._cfg.anim,p=s.getPos(n,a),d=(c.corner.css["margin-top"]||c.corner.css.marginTop||0,c.corner.css["margin-left"]||c.corner.css.marginLeft||0),g=s.$corner;g&&g.css({"margin-left":d+t-p.x}),u.css({"margin-top":p.y,"margin-left":p.x});var v=s.getPos(t,e);u.stop().animate({"margin-top":v.y,"margin-left":v.x},f.duration,f.easing,function(){r&&r()})},renderTemplate:function(t,e){return this.setContent(r(t).render(e))},setContent:function(t){return a("."+this._cfg.clsName+"-tip-content",this.$tip).html(t)},getPos:function(t,e){var r=this,i=r._cfg,n=i.offset,a=e+n.y,s=t+n.x,o=i.alignX,l=i.alignY,h=r.getInstance(),u=h.outerWidth&&h.outerWidth()||h.width(),c=h.outerHeight&&h.outerHeight()||h.height(),f=i.boundry;switch(r.set("x",t||0),r.set("y",e||0),o){case"center":s=Math.round(t)+n.x-u/2;break;case"right":s=Math.round(t)+n.x-u}switch(l){case"middle":a=Math.round(e)+n.y-c/2;break;case"bottom":a=Math.round(e)+n.y-c}if(f.width&&f.height){var p=f.x||0,d=f.y||0,g=f.width,v=f.height;d>a?a=e+Math.abs(n.y):a>d+v-c&&(a=e-c-Math.abs(n.y)),p>s?s=t+Math.abs(n.x):s>p+g-u&&(s=t-u-Math.abs(n.x))}return{x:s,y:a}},_isExist:function(){return this.$tip&&this.$tip[0]},render:function(){var e=this,r=e._cfg,n=e._tpl,o=e._data,l=r.isVisable?"inline-block":"none",h=r.rootNode.offset();if(r.rootNode.offset())return e.$tip=!e._isExist()&&s.create('<span class="'+r.clsName+'-tip" style="*zoom:1;"><span class="'+r.clsName+'-tip-content"></span></span>'),e.$tip=t.Node(e.$tip),s.css(e.$tip,{display:l}),s.append(e.$tip,r.rootNode),e.$corner=r.corner.isShow&&r.corner.tpl?a("<div class='"+r.clsName+"-corner'>"+r.corner.tpl+"</div>").css(r.corner.css).appendTo(e.$tip):i,s.css(e.$tip,{"margin-top":h.top+r.offset.y,"margin-left":h.left+r.offset.x,position:"absolute"}),e.renderTemplate(n,o),e.$tip}}),t.KCharts&&t.KCharts.Tip||t.namespace("KISSY.KCharts"),t.KCharts.Tip=n,n},{requires:["base","gallery/template/1.0/index","./assets/tip.css"]});