KISSY.add("gallery/kcharts/1.1/piechart/index",function(i,p,k,j,m,b){var a=i.DOM,q;function l(s,r){return Math.floor(Math.random()*(r-s+1)+s)}function f(r){return r.length===1?"0"+r:r}function h(){var u,t,s;u=f((l(0,255)).toString(16));t=f((l(0,255)).toString(16));s=f((l(0,255)).toString(16));return"#"+u+t+s}function o(s,r){r=typeof r==undefined?r:2;return s.toFixed(r)}function g(s,r){return parseFloat(s.toFixed(4))}function d(r,w){var v=parseInt(r.substring(1,3),16);var u=parseInt(r.substring(3,5),16);var y=parseInt(r.substring(5,7),16);v=parseInt(v*(100+w)/100);u=parseInt(u*(100+w)/100);y=parseInt(y*(100+w)/100);v=(v<255)?v:255;u=(u<255)?u:255;y=(y<255)?y:255;var t=((v.toString(16).length==1)?"0"+v.toString(16):v.toString(16));var s=((u.toString(16).length==1)?"0"+u.toString(16):u.toString(16));var x=((y.toString(16).length==1)?"0"+y.toString(16):y.toString(16));return"#"+t+s+x}var c={labelPadding:20};function n(r){q=new b({themeCls:r.themeCls})._colors;this.colorseed=0;this.container=i.get(r.renderTo);this.paper=p(i.get(this.container));this.labelLayer=this.paper;this.textlabel=new j();this.cfg={};i.mix(this.cfg,c);i.mix(this.cfg,r);this.sectors=null;this.percentData=null;this.drawSector();this.renderTip()}var e={bindEvent:function(){var z=this.sectors,w=this,x=this.cfg,v=x.data,t=x.cx,s=x.cy,A=x.events||{},r=false,y=null;if(A.enterleave){}else{if(A.click){}}for(var u=0;u<z.length;u++){(function(B){z[B].mouseover(function(C){r=true;y&&clearTimeout(y);w.fire("mouseenter",{sector:z[B],data:v[B],index:B})}).mouseout(function(C){r=false;w.fire("mouseleave",{target:z[B],data:v[B],index:B});y=setTimeout(function(){if(!r){w.tip&&w.tip.hide()}},500)}).click(function(C){w.fire("click",{target:z[B],data:v[B],index:B})})})(u)}},onend:function(){var r=this.cfg,s=this;if(r.labelIndside){this.drawInsideLabel()}else{if(r.label!=false){this.drawLabel()}}this.bindEvent();setTimeout(function(){s.fire("afterRender")},0)},sectorFull:function(z,w,s,B,v,K){var D=Math.PI/180,A=(B+v)/2,H=z+s*Math.cos(-A*D),u=z+s*Math.cos(-B*D),t=z+s*Math.cos(-v*D),F=w+s*Math.sin(-A*D),G=w+s*Math.sin(-B*D),E=w+s*Math.sin(-v*D),C=["M",o(z),w,"L",o(u),o(G),"A",s,s,0,+(Math.abs(v-B)>180),1,o(t),o(E),"z"];var J,I;if(B>v){J=B;I=v}else{J=v;I=B}C.middle={from:J,to:I,angel:A,x:H,y:F};return C},sector:function(w,u,E,N,K,F,J){var O=Math.PI/180,z=(K+F)/2,D=w+E*Math.cos(-z*O),M=w+E*Math.cos(-K*O),L=w+E*Math.cos(-F*O),B=w+N*Math.cos(-K*O),A=w+N*Math.cos(-F*O),C=u+E*Math.sin(-z*O),v=u+E*Math.sin(-K*O),t=u+E*Math.sin(-F*O),H=u+N*Math.sin(-K*O),G=u+N*Math.sin(-F*O),P=["M",o(B),o(H),"L",o(M),o(v),"A",E,E,0,+(Math.abs(F-K)>180),1,o(L),o(t),"L",o(A),o(G),"A",N,N,0,+(Math.abs(F-K)>180),0,o(B),o(H)];var I,s;if(K>F){I=K;s=F}else{I=F;s=K}P.middle={from:I,to:s,angel:z,x:D,y:C};return P},drawSector:function(){var F=this.paper,B=this,z=this.cfg,R=z.data,t=0,P=[],x,M,Q,v=z.cx,u=z.cy,I=z.R,K,L,E=z.colors;this.percentData=P;for(var N=0;N<R.length;N++){var J=i.isNumber(R[N].data)?R[N].data:parseFloat(R[N].data);t+=J}for(var N=0;N<R.length;N++){P.push(R[N].data/t)}var H=B.sectors=[],O=P.length,w=z.r;function C(X){var aa=X.s,Y=X.t;var Z=z.animater?aa*I:I,W,V;for(var U=0;U<O;U++){if(U){W=V;V=W-aa*P[U]*360}else{x=90+P[0]/2*360;M=90-P[0]/2*360;W=x+aa*(90-x);V=W+aa*(M-x)}if(w){K=B.sector(v,u,Z,w,W,V)}else{K=B.sectorFull(v,u,Z,W,V)}if(P[U]==1){if(w){K[12]=parseFloat(K[12])-0.1;K[K.length-2]=parseFloat(K[K.length-2])+0.1}else{K[K.length-3]=parseFloat(K[K.length-3])-0.1}}L=K.join(" ");if(H[U]){H[U].attr("path",L)}else{var r=F.path(L),T;H[U]=r;T=B.getcolor(U,E);H[U].attr({fill:T,stroke:"#fff"});H[U].percent=P[U]}if(aa===1){H[U].middle=K.middle}}}function A(X,aa,Y){aa=X.s,Y=X.t;var Z=aa*I,W,V;for(var U=0;U<O;U++){if(U){W=V;V=W-P[U]*360}else{x=90+P[0]/2*360;M=90-P[0]/2*360;W=x+(90-x);V=W+(M-x)}K=B.sectorFull(v,u,Z,W,V);L=K.join(" ");if(H[U]){H[U].attr("path",L)}else{var r=F.path(L),T;H[U]=r;T=this.getcolor(U);H[U].attr({fill:T,stroke:"#fff"});H[U].percent=P[U]}if(aa===1){H[U].middle=K.middle}}}var G={sector:C,r:A};var s,D=i.mix({type:"sector"},z.anim),S=(i.UA.ie&&i.UA.ie>8&&z.anim)||(!i.UA.ie&&z.anim);s=G[D.type]||C;if(S){var y=new k(D);y.on("step",s,this);y.on("end",this.onend,this);y.run()}else{s({s:1,t:1});this.onend()}},scaleSector:function(u,t,s,r,v){u.scale(t,s,r,v)},transformSector:function(s,t){if(this.currentTransformedSector==s){return}var r,v,u;t||(t=10);if(this.currentTransformedSector){u=this.currentTransformedSector.middle.angel*Math.PI/180;r=t*Math.cos(u);v=-t*Math.sin(u);this.currentTransformedSector.translate(-r,-v)}u=s.middle.angel*Math.PI/180;r=t*Math.cos(u);v=-t*Math.sin(u);s.animate({transform:"t"+r+","+v},400);this.currentTransformedSector=s},getLabelXY:function(r,A,w,z){var s=this.textlabel,u,t,v;u=s.getTextSize(w);if(z){t=r-u.width;v=A-u.height/2}else{t=r+5;v=A-u.height/2}return{x:g(t),y:g(v)}},drawLabel:function(){var t=this.labelLayer,E=this.cfg,P=E.cx,O=E.cy,aa=this.sectors,S,ab,L=aa.length,an=E.data,T=[],ah,V=Math.PI/180,A=Math.cos,F=Math.sin,v=Math.asin,U=Math.abs,ak=Math.round,w,ad,ac,J,aq,I,ap,af=E.R,B=E.R+E.labelPadding,z=E.R+2*E.labelPadding/3,Z,ar=[],N=[],aj,Q;for(var al=0;al<L;al++){S=aa[al];ab=S.middle;Z={};if(-90<=ab.angel&&ab.angel<=90){ar.push(Z)}else{N.push(Z)}w=(ab.angel%360)*V;ad=g(P+af*A(-w));ac=g(O+af*F(-w));J=g(P+z*A(-w));aq=g(O+z*F(-w));I=g(P+B*A(-w));ap=g(O+B*F(-w));Z.i=al;Z.x=ad;Z.y=ac;Z.x1=J;Z.y1=aq;Z.x2=I;Z.y2=ap;S.label=Z}Q=N.length;var M=0,u=Math.round(2*E.R/Q),H,ao,C,ag,K,Y;var ae=a.offset(this.container);while(Q>M){Z=N[M];ao=Z.y2;Y=(ao-O)/B;Y=Y>1?1:Y<-1?-1:Y;w=Math.PI+v(Y);H=g(P+B*A(w));if(M>0){C=N[M-1];K=C.y3;if(K-14<ao){ao=K-14}}H-=5;Z.x3=H;Z.y3=ao;ag=["M",Z.x,Z.y,"Q",Z.x2,Z.y2," ",H,ao];ah=an[Z.i].label;Z.text=ah;var D=this.getLabelXY(H,ao,ah,true);var am=a.create('<span class="ks-charts-label"/>');a.html(am,ah);a.css(this.container,"position","relative");a.css(am,{position:"absolute",left:(D.x)+"px",top:(D.y)+"px"});a.append(am,this.container);var ai=t.path(ag.join(","));ai.toBack();if(E.labelline&&E.labelline.attr){ai.attr(E.labelline.attr)}M++}aj=ar.length;var s=0,W=Math.round(2*E.R/aj);var G=ar.slice(0);while(aj>s){var X;Z=G[s];ao=Z.y2;if(aj>0){C=G[aj-1];if(C.y3+14>ao){ao=C.y3+14}}Y=(ao-O)/B;Y=Y>1?1:Y<-1?-1:Y;w=v(Y);H=g(P+B*A(w));H+=5;Z.x3=H;Z.y3=ao;ag=["M",Z.x,Z.y,"Q",Z.x2,Z.y2," ",H,ao,"L"];ah=an[Z.i].label;Z.text=ah;var D=this.getLabelXY(H,ao,ah);var am=a.create('<span class="ks-charts-label"/>');a.html(am,ah);a.css(this.container,"position","relative");a.css(am,{position:"absolute",left:(D.x)+"px",top:(D.y)+"px"});a.append(am,this.container);var ai=t.path(ag.join(","));ai.toBack();if(E.labelline&&E.labelline.attr){ai.attr(E.labelline.attr)}s++}},drawInsideLabel:function(){var D=this.cfg,A=D.data,I=this.sectors,w=D.cx,u=D.cy,s=D.R;for(var B=0,v=I.length;B<v;B++){var H=A[B].label,t=I[B],K=t.middle,z=K.angel,E=Math.PI/180,G=w+0.5*s*Math.cos(-z*E),F=u+0.5*s*Math.sin(-z*E),J=this.textlabel.getTextSize(H),C=a.create('<span class="ks-charts-label"/>');a.text(C,H);G-=0.5*J.width;F-=0.5*J.height;a.css(this.container,"position","relative");a.css(C,{position:"absolute",left:(G)+"px",top:(F)+"px"});a.append(C,this.container)}},renderTip:function(){var v=this.cfg,x=v.tip,u=this.container,w,s,t,z,y,r;if(x&&x.tpl){t=a.offset(u);z=a.outerWidth(u);y=a.outerHeight(u);w=x.boundryDetect?{x:t.left,y:t.top,width:z,height:y}:{};i.mix(x,{rootNode:i.all(u),boundry:w,autoRender:1});this.tip=new m(x);r=this.tip.getInstance();this.on("mouseenter",function(F){var E=F.sector,C=E.middle,A=C.x,G=C.y,D=p.getRGB(E.attr("fill")),B={};i.mix(B,F.data);B.percent=E.percent;D=d(D.hex,-20);this.tip.renderTemplate(x.tpl,B);a.css(r,{borderColor:D});this.tip.fire("move",{x:A,y:G})},this)}},getcolor:function(v,s){var r=this.cfg,w=s||q,u=w.length,t;v=v%u;if(s&&s[v]){t=w[v].DEFAULT}else{t=q[v].DEFAULT}return t}};i.extend(n,i.Base,e);return n},{requires:["gallery/kcharts/1.1/raphael/index","gallery/kcharts/1.1/ft/index","gallery/kcharts/1.1/label/index","gallery/kcharts/1.1/tip/index","../tools/color/index"]});
