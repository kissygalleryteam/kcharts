KISSY.add("gallery/kcharts/1.1/barchart/index",function(e,s,p,t,q,u,b,f,m){var d=e.all,o=e.Event,c=window,n="ks-chart-",l=n+"default",g=l+"-canvas",a=n+"evtlayout",r=a+"-areas",h=a+"-bars",j="{COLOR}",k;var i=function(v){this.init(v)};e.extend(i,p,{init:function(v){var w=this;p.prototype.init.call(w,v);w.chartType="barchart";if(!w._$ctnNode[0]){return}var y={themeCls:l,autoRender:true,colors:[],stackable:false,title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:true},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:true},xLabels:{isShow:true,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},yLabels:{isShow:true,css:{color:"#666","font-size":"12px","white-space":"nowrap",position:"absolute"}},xAxis:{isShow:true,css:{color:"#eee",zIndex:10}},yAxis:{isShow:true,css:{zIndex:10},num:5},xGrids:{isShow:true,css:{}},yGrids:{isShow:true,css:{}},areas:{isShow:true,css:{}},bars:{isShow:true,css:{background:j,border:"1px solid #fff"},barsRatio:0.6,barRatio:0.5},legend:{isShow:false},tip:{isShow:true,template:"",css:{},anim:{easing:"easeOut",duration:0.3},offset:{x:0,y:0},boundryDetect:true,alignX:"right",alignY:"bottom"}};w._bars={};w._finished=[];l=w._cfg.themeCls||y.themeCls;w._cfg=e.mix(e.mix(y,b[l],f,f,true),w._cfg,f,f,true);w.color=k=new t({themeCls:l});if(w._cfg.colors.length>0){k.removeAllColors()}for(var x in w._cfg.colors){k.setColor(w._cfg.colors[x])}w._cfg.autoRender&&w.render(true)},drawTitle:function(){var y=this,A=y.paper,w=l+"-title",x=y._cfg,v=y._innerContainer,z=v.y*0.6;if(!y._title&&x.title.isShow&&x.title.content!=""){y._title=A.rect(0,0,y._$ctnNode.width(),z).addClass(w).css(e.mix({"line-height":z+"px"},x.title.css))}if(y._title&&x.title.content!=""){y._title.html(x.title.content)}},drawSubTitle:function(){var y=this,A=y.paper,w=l+"-subtitle",x=y._cfg,v=y._innerContainer,z=v.y*0.4;if(!y._subTitle&&x.subTitle.isShow&&x.subTitle.content!=""){y._subTitle=A.rect(0,v.y*0.6,y._$ctnNode.width(),z).addClass(w).css(e.mix({"line-height":z+"px"},x.subTitle.css))}if(y._subTitle&&x.subTitle.content!=""){y._subTitle.html(x.subTitle.content)}},drawBar:function(I,G,J,C,A,K){var N=this,H=N._cfg,v=N.paper,M=g+"-bars",B=N._innerContainer,F=N.processAttr(H.bars.css,A),L=H.zoomType=="x"?false:true,I=(I-0).toFixed(2),G=(G-0).toFixed(2),J=(J-0).toFixed(2),C=(C-0).toFixed(2),E;if(H.anim){var z=H.anim.duration?(e.isNumber(H.anim.duration)?H.anim.duration:0.5):0.5,D=H.anim.easing?H.anim.easing:"easeOut";if(L){E=v.rect(I,G,0,C).attr({posx:I,posy:G}).addClass(M).css(F).animate({width:J,marginLeft:I-B.x},z,D,function(){K&&K()})}else{E=v.rect(I,B.bl.y,J,0).attr({posx:I,posy:G}).addClass(M).css(F).animate({height:C,marginTop:G-B.y},z,D,function(){K&&K()})}}else{E=v.rect(I,G,J,C).attr({posx:I,posy:G}).addClass(M).css(F);K&&K()}return E},getBarsPos:function(){var I=this,G=I._cfg.zoomType,C=I._cfg.stackable,R=I._innerContainer,A=G=="y",Q=C?1:p.prototype.obj2Array(I._clonePoints).length,S=I._cfg.bars.barsRatio,y=I._cfg.bars.barRatio,B=A?(I._pointsY.length>1?(I._pointsY[1].y-I._pointsY[0].y):R.height):(I._pointsX.length>1?(I._pointsX[1].x-I._pointsX[0].x):R.width),L=B*S,T=y>=1?0:(1-y)/y,H=L/(Q+(Q-1)*T),x=H*(1-y)/y,K=C?0:H+x,E=I._innerContainer.bl.y,F=I._innerContainer.bl.x,z=(B*(1-S)-B)/2,J=[];I._barsPos={};for(var O in I._points){var N=[];if(A){for(var M in I._points[O]){var v={},D=Math.abs(I._points[O][M].x-F);v.y=z+I._points[O][M].y;if(C){v.x=F+(J[M]||0);J[M]=J[M]?J[M]+D:D}else{v.x=F}v.width=D;v.height=H;N.push(v)}}else{for(var M in I._points[O]){var v={},P=Math.abs(E-I._points[O][M].y);v.x=z+I._points[O][M].x;if(C){v.y=I._points[O][M].y-(J[M]||0);J[M]=J[M]?J[M]+P:P}else{v.y=I._points[O][M].y}v.width=H;v.height=P;N.push(v)}}z+=K;I._barsPos[O]=N}},drawBars:function(B){var D=this,z=D._cfg;for(var x in D._barsPos){var A=[],C=[];for(var w in D._barsPos[x]){var y=D._barsPos[x][w];C[w]=y;A[w]=D.drawBar(y.x,y.y,y.width,y.height,k.getColor(x).DEFAULT,function(){D._finished.push(true);if(B&&D._finished.length==D._cfg.series.length){B()}}).attr({barGroup:x,barIndex:w,defaultColor:k.getColor(x).DEFAULT,hoverColor:k.getColor(x).HOVER})}var v={bars:A,posInfos:C,color:k.getColor(x)};D._bars[x]=v}return D._bars},drawGridsX:function(){var x=this,z=x._points[0],w;x._gridsX=[];if(x._cfg.zoomType=="x"){w=function(){var A=z.length,C=[];if(A>1){var D=(z[1]["x"]-z[0]["x"])/2;C.push({x:z[0]["x"]-D});for(var B in z){C.push({x:z[B]["x"]-(-D)})}}return C}();for(var y=0,v=w.length;y<v;y++){x._gridsX.push(x.drawGridX(w[y]))}}else{for(var y in x._pointsX){x._gridsX.push(x.drawGridX(x._pointsX[y]))}}return x._gridsX},drawGridX:function(v,z){var x=this,C=x._innerContainer.tl.y,A=x._innerContainer.height,z=z||x._cfg.xAxis.css,B=x.htmlPaper,w=x._cfg.themeCls+"-gridsx";return B.lineY(v.x,C,A).addClass(w).css(x._cfg.xGrids.css)},drawGridY:function(v,A){var z=this,y=z._innerContainer.width,A=A||z._cfg.yGrids.css,B=z.htmlPaper,x=z._cfg.themeCls+"-gridsy";return B.lineX(v.x,v.y,y).addClass(x).css(A)},drawGridsY:function(){var y=this,w=y._innerContainer.tl.x,A=y._cfg.zoomType=="x"?false:true;y._gridsY=[];for(var z=0,v=y._pointsY.length;z<v;z++){y._gridsY[z]={0:y.drawGridY({x:w,y:y._pointsY[z].y}),num:A?y.coordNumX[z]:y.coordNum[z]}}},drawAxisX:function(){var z=this,y=z._innerContainer,B=y.bl,x=y.width,A=z.htmlPaper,v=z._cfg.themeCls+"-axisx";z._axisX=A.lineX(B.x,B.y,x).addClass(v).css(z._cfg.xAxis.css||{});return z._axisX},drawAxisY:function(){var y=this,w=y._innerContainer,x=w.tl,z=w.height,A=y.htmlPaper,v=y._cfg.themeCls+"-axisy";y._axisY=A.lineY(x.x,x.y,z).addClass(v).css(y._cfg.yAxis.css||{});return y._axisY},drawLabelsX:function(){var w=this,v=w._cfg,y=v.zoomType=="y"?true:false;if(y){for(var x in w._pointsX){w._labelX[x]={0:w.drawLabelX(x,w._pointsX[x]["number"])}}}else{for(var x in w._cfg.xAxis.text){w._labelX[x]={0:w.drawLabelX(x,w._cfg.xAxis.text[x])}}}},drawLabelsY:function(){var w=this,v=w._cfg,y=v.zoomType=="x"?false:true;if(y){for(var x in w._cfg.yAxis.text){w._labelY[x]={0:w.drawLabelY(x,w._cfg.yAxis.text[x])}}}else{for(var x in w._pointsY){w._labelY[x]={0:w.drawLabelY(x,w._pointsY[x].number),num:w._pointsY[x].number}}}},drawLabelX:function(y,C){var D=this,v=D.htmlPaper,w=D._pointsX,z=w.length||0,B,E=D._cfg.themeCls+"-xlabels",x="{{data}}",A="";if(y<z){x=D._cfg.xLabels.template||x;if(e.isFunction(x)){A=x(y,C)}else{A=s(x).render({data:C})}B=w[y];B[0]=v.text(B.x,B.y,"<span class="+E+">"+A+"</span>","center").children().css(D._cfg.xLabels.css);return B[0]}},drawLabelY:function(y,B){var w=this,A=w.htmlPaper,v=w._cfg.themeCls+"-ylabels",x="{{data}}",z="";x=w._cfg.yLabels.template||x;if(e.isFunction(x)){z=x(y,B)}else{z=s(x).render({data:B})}return z&&A.text(w._pointsY[y].x,w._pointsY[y].y,"<span class="+v+">"+z+"</span>","right","middle").children().css(w._cfg.yLabels.css)},renderTip:function(){var y=this,x=y._cfg,v=y._innerContainer,z=x.tip.boundryDetect?{x:v.tl.x,y:v.tl.y,width:v.width,height:v.height}:{},w=e.mix(x.tip,{rootNode:y._$ctnNode,clsName:x.themeCls,boundry:z});y.tip=new m(w);return y.tip},renderEvtLayout:function(){var I=this,A=I._innerContainer,E=A.tl.y,H=I._points[0],C=A.height,J=I._multiple,v=I._evtEls._bars=[],w,F;if(!I._evtEls.paper){w=I._evtEls.paper=new q(I._$ctnNode,{clsName:a,prependTo:false,width:A.width,height:C,left:A.tl.x,top:A.tl.y,css:{"z-index":20,background:"#fff",filter:"alpha(opacity =1)","-moz-opacity":0.01,"-khtml-opacity":0.01,opacity:0.01}})}else{w=I._evtEls.paper}for(var B in I._barsPos){var G=[];for(var z in I._barsPos[B]){var D=I._barsPos[B][z];G[z]=w.rect(D.x,D.y,D.width,D.height).addClass(h).attr({barGroup:B,barIndex:z})}I._evtEls._bars.push(G)}return w},clearEvtLayout:function(){var v=this;if(v._evtEls._bars){for(var x in v._evtEls._bars){for(var w in v._evtEls._bars[x]){v._evtEls._bars[x][w].remove()}}}},renderLegend:function(){var w=this,x=w._cfg.legend,v=(x.container&&d(x.container)[0])?d(x.container):w._$ctnNode;w.legend=new u({container:v,chart:w,evtBind:true,css:x.css||{}});return w.legend},render:function(w){var y=this,x=y._cfg,v=y._innerContainer,z=x.themeCls;w&&y._$ctnNode.html("");y.paper=new q(y._$ctnNode,{clsName:g,width:v.width,height:v.height,left:v.tl.x,top:v.tl.y});y._clonePoints=y._points;y.getBarsPos();y.htmlPaper=new q(y._$ctnNode,{clsName:z});y.drawTitle();y.drawSubTitle();y.renderEvtLayout();x.tip.isShow&&y.renderTip();x.xGrids.isShow&&y.drawGridsX();x.yGrids.isShow&&y.drawGridsY();x.xAxis.isShow&&y.drawAxisX();x.yAxis.isShow&&y.drawAxisY();x.xLabels.isShow&&y.drawLabelsX();x.yLabels.isShow&&y.drawLabelsY();x.legend.isShow&&y.renderLegend();y.drawBars(function(){e.log("finished");y.afterRender()});y.bindEvt();e.log(y)},bindEvt:function(){var w=this,v=w._cfg;o.detach(d("."+h,w._$ctnNode),"mouseenter");o.on(d("."+h,w._$ctnNode),"mouseenter",function(A){var x=d(A.currentTarget),y=x.attr("barIndex"),z=x.attr("barGroup");v.tip.isShow&&w.tipHandler(z,y);w.barChange(z,y)});o.detach(d("."+h,w._$ctnNode),"mouseleave");o.on(d("."+h,w._$ctnNode),"mouseleave",function(B){var x=d(B.currentTarget),y=x.attr("barIndex"),A=x.attr("barGroup"),z=w._bars[A]["bars"][y];z.css({background:z.attr("defaultColor")})});o.detach(w._evtEls.paper.$paper,"mouseleave");o.on(w._evtEls.paper.$paper,"mouseleave",function(x){w.tip&&w.tip.hide();w.paperLeave()})},paperLeave:function(){var v=this;v.fire("paperLeave",v)},barChange:function(z,x){var w=this,v=w._bars[z],y=e.mix({target:v.bars[x],currentTarget:v.bars[x],barGroup:Math.round(z),barIndex:Math.round(x)},w._points[z][x]);w.fire("barChange",y)},tipHandler:function(D,z){var H=this,E=H._cfg,F=H.tip,G=E.zoomType=="y"?true:false,y=F.getInstance(),x=H._bars[D]["bars"][z],w=x.attr("defaultColor"),A=H._cfg.tip.template,C=G?x.attr("posx")-(-x.width())-(-H._innerContainer.x):x.attr("posx"),B=x.attr("posy"),v=e.merge(H._points[D][z].dataInfo,E.series[D]);delete v.data;H._points[D][z]["dataInfo"],x.css({background:x.attr("hoverColor")});if(!A){return}F.fire("setcontent",{data:v});F.fire("move",{x:C,y:B,style:H.processAttr(E.tip.css,w)})},animateGridsAndLabels:function(){var w=this,v=w._cfg.zoomType;if(v=="y"){for(var x in w._labelX){w._labelX[x]&&w._labelX[x][0]&&d(w._labelX[x][0]).remove();w._gridsX[x]&&w._gridsX[x][0]&&d(w._gridsX[x][0]).remove()}w.drawGridsX();w.drawLabelsX()}else{if(v=="x"){for(var x in w._labelY){w._labelY[x]&&w._labelY[x][0]&&w._labelY[x][0].remove();w._gridsY[x]&&w._gridsY[x][0]&&w._gridsY[x][0].remove()}w.drawGridsY();w.drawLabelsY()}}},processAttr:function(w,v){var y=e.clone(w);for(var x in y){if(y[x]&&typeof y[x]=="string"){y[x]=y[x].replace(j,v)}}return y},showBar:function(z){var x=this,v=x._innerContainer;p.prototype.recoveryData.call(x,z);x._clonePoints[z]=x._points[z];x.animateGridsAndLabels();x.getBarsPos();for(var A in x._bars){if(A!=z){for(var y in x._bars[A]["bars"]){if(x._barsPos[A]){var B=x._barsPos[A][y];B&&x._bars[A]["bars"][y].stop().animate({height:B.height,width:B.width,marginTop:B.y-v.y,marginLeft:B.x-v.x},0.4,"easeOut",function(){});x._bars[A]["bars"][y].attr({posx:B.x,posy:B.y})}}}}var C=[],w=[];for(var y in x._barsPos[z]){var B=x._barsPos[z][y];C[y]=B;w[y]=x.drawBar(B.x,B.y,B.width,B.height,k.getColor(z).DEFAULT).attr({barGroup:z,barIndex:y,defaultColor:k.getColor(z).DEFAULT,hoverColor:k.getColor(z).HOVER})}x._bars[z]={bars:w,posInfos:C,color:k.getColor(A)};x.clearEvtLayout();x.renderEvtLayout();x.bindEvt();e.log(x)},hideBar:function(y){var w=this,v=w._innerContainer;p.prototype.removeData.call(w,y);delete w._clonePoints[y];w.animateGridsAndLabels();w.getBarsPos();for(var z in w._bars[y]["bars"]){w._bars[y]["bars"][z].remove()}for(var z in w._bars){if(z!=y){for(var x in w._bars[z]["bars"]){var A=w._barsPos[z]?w._barsPos[z][x]:"";A&&w._bars[z]["bars"][x].stop().animate({height:A.height,width:A.width,marginTop:A.y-v.y,marginLeft:A.x-v.x},0.4,"easeOut",function(){});w._bars[z]["bars"][x].attr({posx:A.x,posy:A.y})}}}w.clearEvtLayout();w.renderEvtLayout();w.bindEvt();e.log(w)},afterRender:function(){var v=this;v.fire("afterRender",v)},getPaper:function(){return this.paper},clear:function(){return this.paper.clear()}});return i},{requires:["gallery/template/1.0/index","../basechart/index","../tools/color/index","../tools/htmlpaper/index","../legend/index","./theme","../tools/touch/index","../tip/index"]});KISSY.add("gallery/kcharts/1.1/barchart/theme",function(b){var c="{COLOR}";var a={"ks-chart-default":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:true},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:true},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},tip:{css:{border:"2px solid {COLOR}"}}},"ks-chart-analytiks":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:true},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:true},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},tip:{css:{background:"{COLOR}"}}},"ks-chart-rainbow":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:true},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:true},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},tip:{css:{background:"{COLOR}"}}}};return a});
