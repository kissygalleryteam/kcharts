KISSY.add("gallery/kcharts/1.1/tip/index",function(m,q,r,n){function p(a){if(a){var c={clsName:"ks-chart-default",autoRender:!0,isVisable:!1,boundry:{x:0,y:0,width:0,height:0},rootNode:h("body"),tpl:"",corner:{isShow:!1,tpl:"corner",css:{position:"absolute",marginLeft:0,marginTop:0}},anim:{easing:"easeOut",duration:0.25},offset:{x:0,y:0},alignX:"left",alignY:"top"};this._events={MOVE:"move",SETCONT:"setcontent",HIDE:"hide"};this._cfg=m.mix(c,a,n,n,!0);this._cfg.rootNode=h(this._cfg.rootNode);this.init()}}
var h=m.all;m.augment(p,q,{init:function(){var a=this._cfg;this._data={};this._tpl=a.tpl;this.$tip;this.bindEvent();a.autoRender&&this.render()},bindEvent:function(){var a=this,c=a._cfg.template,d=a._events;a.on(d.MOVE,function(b){var c=b.x,d=b.y;b=b.style;a.isVisable()&&a._cfg.anim?a.animateTo(c,d):a.moveTo(c,d);b&&a.$tip.css(b)});a.on(d.SETCONT,function(b){m.isFunction(c)?a.setContent(c(b.data)):a.renderTemplate(c,b.data)});a.on(d.HIDE,function(b){a.hide()})},getInstance:function(){return this.$tip},
isVisable:function(){return"none"==this.$tip.css("display")?!1:!0},show:function(){this.$tip&&this.$tip.show();return this},hide:function(){this.$tip&&this.$tip.stop()&&this.$tip.hide();return this},moveTo:function(a,c){this._prevtime=(new Date).getTime();this.show();var d=this.getInstance(),b=this._cfg,e=this.getPos(a,c),b=b.corner.css["margin-left"]||b.corner.css.marginLeft||0,f=this.$corner;f&&f.css({"margin-left":b+a-e.x});d.css({"margin-top":e.y,"margin-left":e.x})},animateTo:function(a,c,d){var b=
this._cfg,e=b.anim,f=(new Date).getTime();this._prevtime&&100>f-this._prevtime&&this.animateFast(a,c,d);this.show();this._prevtime=(new Date).getTime();f=this.getInstance();c=this.getPos(a,c);var b=b.corner.css["margin-left"]||b.corner.css.marginLeft||0,g=this.$corner;g&&g.css({"margin-left":b+a-c.x});f.stop().animate({"margin-top":c.y,"margin-left":c.x},e.duration,e.easing,function(){d&&d()})},animateFast:function(a,c,d){var b=this.get("x"),e=this.get("y"),f,g;this._prevtime=(new Date).getTime();
this.show();b!==n&&(f=b/1+0.2*(a-b),g=e/1+0.2*(c-e));var b=this.getInstance(),k=this._cfg,e=this._cfg.anim;f=this.getPos(f,g);g=k.corner.css["margin-left"]||k.corner.css.marginLeft||0;(k=this.$corner)&&k.css({"margin-left":g+a-f.x});b.css({"margin-top":f.y,"margin-left":f.x});a=this.getPos(a,c);b.stop().animate({"margin-top":a.y,"margin-left":a.x},e.duration,e.easing,function(){d&&d()})},renderTemplate:function(a,c){return this.setContent(r(a).render(c))},setContent:function(a){return h("."+this._cfg.clsName+
"-tip-content",this.$tip).html(a)},getPos:function(a,c){var d=this._cfg,b=d.offset,e=c+b.y,f=a+b.x,g=d.alignX,k=d.alignY,l=this.getInstance(),h=l.outerWidth(),l=l.outerHeight(),d=d.boundry;this.set("x",a||0);this.set("y",c||0);switch(g){case "center":f=Math.round(a)+b.x-h/2;break;case "right":f=Math.round(a)+b.x-h}switch(k){case "middle":e=Math.round(c)+b.y-l/2;break;case "bottom":e=Math.round(c)+b.y-l}if(d.width&&d.height){var g=d.x||0,k=d.y||0,m=d.width,d=d.height;e<k?e=c- -Math.abs(b.y):e>k+d-
l&&(e=c-l-Math.abs(b.y));f<g?f=a- -Math.abs(b.x):f>g+m-h&&(f=a-h-Math.abs(b.x))}return{x:f,y:e}},_isExist:function(){return this.$tip&&this.$tip[0]},render:function(){var a=this._cfg,c=this._tpl,d=this._data,b=a.isVisable?"inline-block":"none",e=a.rootNode.offset();if(a.rootNode.offset())return this.$tip=!this._isExist()&&h('<span class="'+a.clsName+'-tip" style="*zoom:1;"><span class="'+a.clsName+'-tip-content"></span></span>').css({display:b}).appendTo(a.rootNode),this.$corner=a.corner.isShow&&
a.corner.tpl?h("<div class='"+a.clsName+"-corner'>"+a.corner.tpl+"</div>").css(a.corner.css).appendTo(this.$tip):n,this.$tip.css({"margin-top":e.top+a.offset.y,"margin-left":e.left+a.offset.x,position:"absolute"}),this.renderTemplate(c,d),this.$tip}});return p},{requires:["base","gallery/template/1.0/index","./assets/tip.css"]});
