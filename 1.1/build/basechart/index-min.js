KISSY.add("gallery/kcharts/1.1/basechart/index",function(s,A){var y=s.all,z=function(){};s.extend(z,A,{init:function(a){var d;if(a&&a.renderTo&&(d=this._cfg=s.mix({zIndex:0,yAxis:{},canvasAttr:{x:60,y:60},defineKey:{},zoomType:"x"},a),this._$ctnNode=y(a.renderTo),this._$ctnNode.css({"-webkit-text-size-adjust":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"}),this.getInnerContainer(),s.mix(this,{_datas:{cur:{},total:{}},_points:{},_centerPoints:[],_pointsX:[],_pointsY:[],_gridsX:[],_gridsY:[],
_areas:[],_axisX:null,_axisY:null,_labelX:[],_labelY:[],_evtEls:[],_gridPoints:[],_multiple:!1,stackable:!1}),(a=d.series||null)&&!(0>=a.length)&&a[0].data)){1<a.length?this._multiple=!0:void 0;for(var c in a)this._datas.total[c]={index:c,data:a[c].data},this._datas.cur[c]={index:c,data:a[c].data};this.dataFormat()}},removeData:function(a){delete this._datas.cur[a];this.dataFormat()},recoveryData:function(a){this._datas.cur[a]=this._datas.total[a];this.dataFormat()},getInnerContainer:function(){var a=
this._$ctnNode,d=s.mix(this._cfg.canvasAttr),c=d.width||a.width()-2*d.x,a=d.height||a.height()-2*d.y,e=d.x,d=d.y;return this._innerContainer={x:e,y:d,width:c,height:a,tl:{x:e,y:d},tr:{x:e+c,y:d},bl:{x:e,y:d+a},br:{x:e+c,y:d+a}}},getAllDatas:function(a){var d=this._cfg,c=[],e=d.zoomType,f,m=this.getDataType();if(d.stackable)for(var k in this._datas.cur){"object"==m&&d.defineKey.y&&d.defineKey.x?f=this.getArrayByKey(this._datas.cur[k].data,d.defineKey.y):s.isArray(this._datas.cur[k].data)&&(f=this._datas.cur[k].data);
for(var h in f)c[h]=c[h]?f[h]+c[h]:f[h]}else for(k in this._datas.cur)"object"==m&&d.defineKey.y&&d.defineKey.x?f=this.getArrayByKey(this._datas.cur[k].data,d.defineKey.y):s.isArray(this._datas.cur[k].data)&&(f="xy"==e?this.getArrayByKey(this._datas.cur[k].data,a):this._datas.cur[k].data),c.push(f.join(","));return c.length?c.join(",").split(","):[]},getDataType:function(){if(this._datas.total[0]&&this._datas.total[0].data)for(var a in this._datas.total[0].data){if(s.isPlainObject(this._datas.total[0].data[a]))return"object";
if(s.isNumber(this._datas.total[0].data[a]-0))return"number"}},_getScales:function(a,d){if(d.text&&s.isArray(d.text))return d.text;var c=d.max-0,e=d.min-0,f=d.num||5,m=Math.max.apply(null,a),k=Math.min.apply(null,a),h=0.1*(m-k)||1*h||10,h;return this.getScales(c||0==c?c>=m?c>=m+h?m+h:c:m+h:m+h,e||0==e?e<=k?e<=k-h?k-h:e:k-h:k-h,f)},dataFormat:function(){var a=this._cfg,d=a.zoomType,c=this._innerContainer,e=c.width,f=c.height,m=c.x,c=c.y,k,h,p,l,r;this._pointsY=[];this._pointsX=[];"x"==d?(k=this.getAllDatas(),
k=p=this.coordNum=this._getScales(k,a.yAxis),l=this.data2GrapicData(p,!1,!0)):"y"==d?(h=this.getAllDatas(),k=h=this.coordNumX=this._getScales(h,a.xAxis),r=this.data2GrapicData(h,!0,!1)):"xy"==d&&(k=this.getAllDatas(0),h=this.getAllDatas(1),k=p=this.coordNum=this._getScales(k,a.xAxis),h=this.coordNumX=this._getScales(h,a.yAxis),l=this.data2GrapicData(p,!1,!1),r=this.data2GrapicData(h,!0,!0));if("x"==d){for(var n in l)this._pointsY[n]={number:p[n]+"",y:l[n],x:m};try{this._gridPoints=this.getSplitPoints(m,
c+f,m+e,c+f,a.xAxis.text.length,!0),this._pointsX=this.getCenterPoints(this._gridPoints)}catch(z){throw Error("\u672a\u914d\u7f6e\u6b63\u786e\u7684xAxis.text\u6570\u7ec4");}}else if("y"==d){for(n in r)this._pointsX[n]={number:h[n]+"",y:c+f,x:r[n]};try{this._pointsY=this.getSplitPoints(m,c,m,c+f,a.yAxis.text.length+1)}catch(A){throw Error("\u672a\u914d\u7f6e\u6b63\u786e\u7684yAxis.text\u6570\u7ec4");}}else if("xy"==d){for(n in r)this._pointsY[n]={number:h[n]+"",y:r[n],x:m};for(n in l)this._pointsX[n]={number:p[n]+"",y:c+f,x:l[n]}}for(n in this._datas.cur){p=this._points;h=n;l=
this._datas.cur[n].data;var q=k;r=a.series[n];var u=Math.max.apply(null,q),v=Math.min.apply(null,q),q=a.defineKey,w=q.x,x=q.y,q=[],t=0,y=this.getDataType();if("x"==d)if(w&&x&&"object"==y){var g=void 0;for(g in this._pointsX)l[t]&&a.xAxis.text[g]==l[t][w]?(q[g]={x:this._pointsX[g].x,y:this.data2Grapic(l[t][x],u,v,f,c,!0),dataInfo:l[t],index:Math.round(g)},t++):q[g]={x:this._pointsX[g].x,index:Math.round(g)}}else for(g in this._pointsX)q[g]=""===l[g]||null===l[g]?{x:this._pointsX[g].x,index:Math.round(g)}:
{x:this._pointsX[g].x,y:this.data2Grapic(l[g],u,v,f,c,!0),dataInfo:{y:l[g]},index:Math.round(g)};else if("y"==d)if(w&&x&&s.isPlainObject(this._datas.total[0].data[0]))for(g in this._pointsY)l[t]&&a.yAxis.text[g]==l[t][w]?(q[g]={x:this.data2Grapic(l[t][x],u,v,e,m),y:this._pointsY[g].y,dataInfo:{y:l[t]},index:Math.round(g)},t++):q[g]={y:this._pointsY[g].y,index:Math.round(g)};else for(g in this._pointsY)q[g]={x:this.data2Grapic(l[g],u,v,e,m),y:this._pointsY[g].y,dataInfo:{y:l[g]},index:Math.round(g)};
else if("xy"==d)for(g in u=this.data2GrapicData(this.getArrayByKey(r.data,0)),v=this.data2GrapicData(this.getArrayByKey(r.data,1),!0,!0),r.data)q[g]={x:u[g],y:v[g],dataInfo:{y:l[g]},index:Math.round(g)};p[h]=q}},data2GrapicData:function(a,d,c){if(a){var e=this._innerContainer,f=d?e.x:e.y,m=e.height,e=e.width,k=this._cfg.zoomType,h,p=d?Math.max.apply(null,this.coordNumX):Math.max.apply(null,this.coordNum),l=d?Math.min.apply(null,this.coordNumX):Math.min.apply(null,this.coordNum),r=[];"xy"==k?h=d?m:
e:"x"==k?h=m:"y"==k&&(h=e);if(s.isArray(a)){for(var n in a)r.push(this.data2Grapic(a[n],p,l,h,f,c));return r}return this.data2Grapic(a,p,l,h,f,c)}},data2Grapic:function(a,d,c,e,f,m){if(!(0>=d-c))return m?e*(1-(a-c)/(d-c))+f:e*(a-c)/(d-c)+f},getSplitPoints:function(a,d,c,e,f,m){var k=(c-a)/f,h=(e-d)/f,p=[];m&&p.push({x:a,y:d});for(var l=0;l<f-1;l++)p.push({x:a+(l+1)*k,y:d+(l+1)*h});m&&p.push({x:c,y:e});return p},getCenterPoints:function(a){var d=[],c=a.length;if(1<c)for(var e=0;e<c-1;e++)d[e]={x:(a[e].x+
a[e+1].x)/2,y:(a[e].y+a[e+1].y)/2};return d},getScales:function(a,d,c){var e,f;e=Math.log;f=Math.pow;var m=[],k=0;if(!(a<=d)){c=(a-d)/c;e=Math.floor(e(c)/e(10))+1;c/=f(10,e);f=(0<c&&0.1>=c?0.1:0.1<c&&0.2>=c?0.2:0.2<c&&0.25>=c?0.25:0.25<c&&0.5>=c?0.5:1)*f(10,e);for(e=c=(a+d)/2-(a+d)/2%f;e>d;)e-=f;for(;c<a;)c+=f;this.isFloat(f)&&(a=f+"",-1<a.indexOf(".")&&(k=a.split(".")[1].length));for(a=e;a<=c;a+=f)m.push(parseFloat(a).toFixed(k));return m}},arraySort:function(a,d,c){return a.sort(function(a,f){return d?
"object"==typeof a&&"object"==typeof f?f[c]-a[c]:f-a:"object"==typeof a&&"object"==typeof f?a[c]-f[c]:a-f})},getArrayByKey:function(a,d){var c=[],e;for(e in a)c.push(a[e][d]);return c},isFloat:function(a){return/^([+-]?)\d*\.\d+$/.test(a)},obj2Array:function(a,d){var c=[],e;for(e in a)c.push(d?a[d]:a[e]);return c},getObjKeys:function(a){var d=[];for(b in a)d.push(b);return d}});return z},{requires:["base"]});
