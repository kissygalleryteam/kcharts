KISSY.add("gallery/kcharts/1.1/basechart/index",function(d,c){var e=d.all;var a=function(){};d.extend(a,c,{init:function(f){var h=this,g,k;if(f&&f.renderTo){g=h._cfg=d.mix({zIndex:0,yAxis:{},canvasAttr:{x:60,y:60},defineKey:{},zoomType:"x"},f);h._$ctnNode=e(f.renderTo);h._$ctnNode.css({"-webkit-text-size-adjust":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"});h.getInnerContainer();d.mix(h,{_datas:{cur:{},total:{}},_points:{},_centerPoints:[],_pointsX:[],_pointsY:[],_gridsX:[],_gridsY:[],_areas:[],_axisX:null,_axisY:null,_labelX:[],_labelY:[],_evtEls:[],_gridPoints:[],_multiple:false,stackable:false});k=g.series||null;if(!k||k.length<=0||!k[0].data){return}k.length>1?h._multiple=true:undefined;for(var j in k){h._datas.total[j]={index:j,data:k[j].data};h._datas.cur[j]={index:j,data:k[j].data}}h.dataFormat()}},removeData:function(g){var f=this;delete f._datas.cur[g];f.dataFormat()},recoveryData:function(g){var f=this;f._datas.cur[g]=f._datas.total[g];f.dataFormat()},getInnerContainer:function(){var r=this,o=r._$ctnNode,i=d.mix(r._cfg.canvasAttr),k=i.width||(o.width()-2*i.x),f=i.height||(o.height()-2*i.y),m=i.x,l=i.y,g=k,n=f,q={x:m,y:l},j={x:m+k,y:l},h={x:m,y:l+n},p={x:m+k,y:l+n};r._innerContainer={x:m,y:l,width:g,height:n,tl:q,tr:j,bl:h,br:p};return r._innerContainer},getAllDatas:function(){var m=this,k=m._cfg,h=[],n=k.zoomType,o,p=arguments[0],l=m.getDataType();if(k.stackable){for(var g in m._datas.cur){if(l=="object"&&k.defineKey.y&&k.defineKey.x){o=m.getArrayByKey(m._datas.cur[g]["data"],k.defineKey.y)}else{if(d.isArray(m._datas.cur[g]["data"])){if(n=="xy"){o=m.getArrayByKey(m._datas.cur[g]["data"],p)}else{o=m._datas.cur[g]["data"]}}}}for(var f in o){h[f]=h[f]?o[f]+h[f]:o[f]}}else{for(var g in m._datas.cur){if(l=="object"&&k.defineKey.y&&k.defineKey.x){o=m.getArrayByKey(m._datas.cur[g]["data"],k.defineKey.y)}else{if(d.isArray(m._datas.cur[g]["data"])){if(n=="xy"){o=m.getArrayByKey(m._datas.cur[g]["data"],p)}else{o=m._datas.cur[g]["data"]}}}h.push(o.join(","))}}return h.length?h.join(",").split(","):[]},getDataType:function(){var f=this;if(!f._datas.cur[0]||!f._datas.cur[0]["data"]){return}for(var g in f._datas.cur[0]["data"]){if(d.isPlainObject(f._datas.cur[0]["data"][g])){return"object"}else{if(d.isNumber(f._datas.cur[0]["data"][g]-0)){return"number"}}}},_getScales:function(i,f){var p=this,n=p._cfg;if(f.text&&d.isArray(f.text)){return f.text}else{var o=f.max-0,k=f.min-0,j=f.num||5,q=Math.max.apply(null,i),l=Math.min.apply(null,i),h=(q-l)*0.1||g*1||10,m=o||o==0?(o>=q?(o>=q+h?q+h:o):q+h):q+h,g=(k||k==0)?(k<=l?(k<=l-h?l-h:k):l-h):l-h;return p.getScales(m,g,j)}},dataFormat:function(){var r=this,o=r._cfg,q=o.zoomType,k=q=="x"?false:true,p=r._innerContainer,v=p.width,s=p.height,n=p.x,m=p.y,A,l,j,t,h,u,f;r._pointsY=[];r._pointsX=[];if(q=="x"){A=r.getAllDatas();f=j=r.coordNum=r._getScales(A,o.yAxis);h=r.data2GrapicData(j,false,true)}else{if(q=="y"){l=r.getAllDatas();f=t=r.coordNumX=r._getScales(l,o.xAxis);u=r.data2GrapicData(t,true,false)}else{if(q=="xy"){A=r.getAllDatas(0);l=r.getAllDatas(1);f=j=r.coordNum=r._getScales(A,o.xAxis);t=r.coordNumX=r._getScales(l,o.yAxis);h=r.data2GrapicData(j,false,false);u=r.data2GrapicData(t,true,true)}}}var g=function(D,F,N){var E=o.series[F],H=Math.max.apply(null,N),B=Math.min.apply(null,N),G=o.defineKey,L=G.x,J=G.y,K=[],y=0,I=r.getDataType();if(q=="x"){if(L&&J&&I=="object"){for(var C in r._pointsX){if(D[y]&&o.xAxis.text[C]==D[y][L]){K[C]={x:r._pointsX[C].x,y:r.data2Grapic(D[y][J],H,B,s,m,true),dataInfo:D[y],index:Math.round(C)};y++}else{K[C]={x:r._pointsX[C].x,index:Math.round(C)}}}}else{for(var C in r._pointsX){if(D[C]===""||D[C]===null){K[C]={x:r._pointsX[C].x,index:Math.round(C)}}else{K[C]={x:r._pointsX[C].x,y:r.data2Grapic(D[C],H,B,s,m,true),dataInfo:{y:D[C]},index:Math.round(C)}}}}}else{if(q=="y"){if(L&&J&&d.isPlainObject(r._datas.total[0]["data"][0])){for(var C in r._pointsY){if(D[y]&&o.yAxis.text[C]==D[y][L]){K[C]={x:r.data2Grapic(D[y][J],H,B,v,n),y:r._pointsY[C].y,dataInfo:{y:D[y]},index:Math.round(C)};y++}else{K[C]={y:r._pointsY[C].y,index:Math.round(C)}}}}else{for(var C in r._pointsY){K[C]={x:r.data2Grapic(D[C],H,B,v,n),y:r._pointsY[C].y,dataInfo:{y:D[C]},index:Math.round(C)}}}}else{if(q=="xy"){var x=r.data2GrapicData(r.getArrayByKey(E.data,0)),M=r.data2GrapicData(r.getArrayByKey(E.data,1),true,true);for(var C in E.data){K[C]={x:x[C],y:M[C],dataInfo:{y:D[C]},index:Math.round(C)}}}}}return K};if(q=="x"){for(var w in h){r._pointsY[w]={number:j[w]+"",y:h[w],x:n}}try{r._gridPoints=r.getSplitPoints(n,m+s,n+v,m+s,o.xAxis.text.length,true);r._pointsX=r.getCenterPoints(r._gridPoints)}catch(z){throw new Error("\u93c8\ue048\u53a4\u7f03\ue1bd\ue11c\u7ead\ue1be\u6b91xAxis.text\u93c1\u626e\u7c8d")}}else{if(q=="y"){for(var w in u){r._pointsX[w]={number:t[w]+"",y:m+s,x:u[w]}}try{r._pointsY=r.getSplitPoints(n,m,n,m+s,o.yAxis.text.length+1)}catch(z){throw new Error("\u93c8\ue048\u53a4\u7f03\ue1bd\ue11c\u7ead\ue1be\u6b91yAxis.text\u93c1\u626e\u7c8d")}}else{if(q=="xy"){for(var w in u){r._pointsY[w]={number:t[w]+"",y:u[w],x:n}}for(var w in h){r._pointsX[w]={number:j[w]+"",y:m+s,x:h[w]}}}}}for(var w in r._datas.cur){r._points[w]=g(r._datas.cur[w]["data"],w,f)}},data2GrapicData:function(m,r,j){if(!m){return}var s=this,t=s._innerContainer,g=r?t.x:t.y,p=t.height,f=t.width,q=s._cfg.zoomType,n,o=r?Math.max.apply(null,s.coordNumX):Math.max.apply(null,s.coordNum),h=r?Math.min.apply(null,s.coordNumX):Math.min.apply(null,s.coordNum),l=[];if(q=="xy"){n=r?p:f}else{if(q=="x"){n=p}else{if(q=="y"){n=f}}}if(d.isArray(m)){for(var k in m){l.push(s.data2Grapic(m[k],o,h,n,g,j))}return l}else{return s.data2Grapic(m,o,h,n,g,j)}},data2Grapic:function(i,f,g,k,j,h){if(f-g<=0){return}if(h){return k*(1-(i-g)/(f-g))+j}else{return k*(i-g)/(f-g)+j}},getSplitPoints:function(p,o,n,m,j,l){var g=(n-p)/j,f=(m-o)/j,k=[];l&&k.push({x:p,y:o});for(var h=0;h<j-1;h++){k.push({x:p+(h+1)*g,y:o+(h+1)*f})}l&&k.push({x:n,y:m});return k},getCenterPoints:function(k){var g=this,j=[],f=k.length;if(f>1){for(var h=0;h<f-1;h++){j[h]={x:(k[h]["x"]+k[h+1]["x"])/2,y:(k[h]["y"]+k[h+1]["y"])/2}}}return j},getScales:function(k,g,w){var q=this,m,h,o,u,j,p,r,t,y,l=Math.log,f=Math.pow,v=[],x=0;if(k<=g){return}m=(k-g)/w;u=Math.floor(l(m)/l(10))+1;h=m/f(10,u);if(h>0&&h<=0.1){h=0.1}else{if(h>0.1&&h<=0.2){h=0.2}else{if(h>0.2&&h<=0.25){h=0.25}else{if(h>0.25&&h<=0.5){h=0.5}else{h=1}}}}j=h*f(10,u);y=(k+g)/2-((k+g)/2)%j;r=t=y;while(r>g){r-=j}while(t<k){t+=j}if(q.isFloat(j)){var n=(j+"");if(n.indexOf(".")>-1){x=n.split(".")[1]["length"]}}for(var s=r;s<=t;s+=j){v.push(parseFloat(s).toFixed(x))}return v},arraySort:function(h,f,g){return h.sort(function(j,i){if(!f){if(typeof j=="object"&&typeof i=="object"){return j[g]-i[g]}return j-i}else{if(typeof j=="object"&&typeof i=="object"){return i[g]-j[g]}return i-j}})},getArrayByKey:function(j,h){var g=[];for(var f in j){j[f][h]?g.push(j[f][h]):undefined}return g},isFloat:function(f){return/^([+-]?)\d*\.\d+$/.test(f)},obj2Array:function(j,h){var f=[];for(var g in j){f.push(h?j[h]:j[g])}return f},getObjKeys:function(g){var f=[];for(b in g){f.push(b)}return f}});return a},{requires:["base"]});
