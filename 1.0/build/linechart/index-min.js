KISSY.add("gallery/kcharts/1.0/linechart/index",function(e,h,o,p,c,q,l,f){var d=e.all,n=e.Event,m="ks-chart-",k=m+"default",a=m+"evtlayout",r=a+"-areas",g=a+"-rects",i="{COLOR}",j;var b=function(s){var t=this;t._cfg=s;t.init()};e.extend(b,p,{init:function(){var s=this;p.prototype.init.call(s,s._cfg);var u={themeCls:k,autoRender:true,comparable:false,lineType:"straight",colors:[],title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:true},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:true},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:i},hoverAttr:{stroke:"#fff",r:5,fill:i,"stroke-width":0}},xLabels:{isShow:true,css:{}},yLabels:{isShow:true,css:{}},xAxis:{isShow:true,css:{}},yAxis:{isShow:true,css:{},num:5},xGrids:{isShow:true,css:{}},yGrids:{isShow:true,css:{}},areas:{isShow:true,css:{}},line:{isShow:true,attr:{"stroke-width":"3px"},hoverAttr:{}},pointLines:{isShow:false,css:{}},tip:{isShow:true,clsName:"",template:"",css:{},offset:{x:0,y:0},boundryDetect:true}};s._lines={};s._finished=[];s._cfg=e.mix(u,s._cfg,f,f,true);k=s._cfg.themeCls;s.color=j=new c();if(s._cfg.colors.length>0){j.removeAllColors()}for(var t in s._cfg.colors){j.setColor(s._cfg.colors[t])}s._cfg.autoRender&&s.render(true)},drawTitle:function(){var v=this,x=v.htmlPaper,t=k+"-title",u=v._cfg,s=v._innerContainer,w=s.y*0.6;if(u.title.isShow&&u.title.content!=""){v._title=x.rect(0,0,v._$ctnNode.width(),w).addClass(t).css(e.mix({"line-height":w+"px"},u.title.css)).html(u.title.content)}},drawSubTitle:function(){var v=this,x=v.htmlPaper,t=k+"-subtitle",u=v._cfg,s=v._innerContainer,w=s.y*0.4;if(u.subTitle.isShow&&u.subTitle.content!=""){v._subTitle=x.rect(0,s.y*0.6,v._$ctnNode.width(),w).addClass(t).css(e.mix({"line-height":w+"px"},u.subTitle.css)).html(u.subTitle.content)}},animateLine:function(D,F,E){if(D&&D.length){var G=this,t=G.paper,w=e.mix({stroke:j.getColor(F).DEFAULT},G._cfg.line.attr),u=G._innerContainer.bl.y,z=D.length,s=[],C,B=G._cfg,v=G._cfg.anim.duration||100,A=G._cfg.anim.easing||"easeIn",y=1,H="",x=function(){if(D[y]&&D[y]["x"]&&D[y]["y"]&&y<z){if(G._cfg.lineType=="arc"){var I=(D[y]["x"]+D[y-1]["x"])/2;H+=" C"+I+","+D[y-1]["y"]+","+I+","+D[y]["y"]+","+D[y]["x"]+","+D[y]["y"]}else{H+=" L"+D[y]["x"]+","+D[y]["y"]}C&&C.animate({path:H},v,A,function(){s[y]=G.drawStock(D[y]["x"],D[y]["y"],G._stocks[F]["attr"]);y++;x();if(y==z){G._stocks[F]["stocks"]=s;G._finished.push(true);if(E&&G._finished.length==G._cfg.series.length){E()}}})}};H+="M"+D[0]["x"]+","+D[0]["y"];C=t.path(H).attr(w);s[0]=G.drawStock(D[0]["x"],D[0]["y"],G.processAttr(G._cfg.points.attr,j.getColor(F).DEFAULT));x();return C}},getLinePath:function(w){var u=this,y="",x=u._innerContainer.bl.y;if(!w||!w[0]||!w[0]["x"]||!w[0]["y"]){return""}y+="M"+w[0]["x"]+","+w[0]["y"];if(u._cfg.lineType=="arc"){for(var v=1,t=w.length;v<t;v++){if(w[v]["x"]&&w[v]["y"]){var s=(w[v]["x"]+w[v-1]["x"])/2;y+=" C"+s+","+w[v-1]["y"]+","+s+","+w[v]["y"]+","+w[v]["x"]+","+w[v]["y"]}}}else{for(var v=1,t=w.length;v<t;v++){if(w[v]["x"]&&w[v]["y"]){y+=" L"+w[v]["x"]+","+w[v]["y"]}}}return y},drawLine:function(u,s){if(u){var t=this,v=t.paper;return v.path(u).attr(e.mix(t._cfg.line.attr,s))}},drawLines:function(z){var u=this,t=u._cfg;u._lines={};u._stocks={};if(t.anim){for(var w in u._points){var x=u.getLinePath(u._points[w]),v=j.getColor(w),s=u.processAttr(u._cfg.points.attr,v.DEFAULT),y=u.processAttr(u._cfg.points.hoverAttr,v.HOVER);u._lines[w]={line:u.animateLine(u._points[w],w,z),path:x,points:u._points[w],color:v,attr:e.mix({stroke:v.DEFAULT},u._cfg.line.attr)};u._stocks[w]={points:u._points[w],color:v,attr:s,hoverAttr:y}}}else{for(var w in u._points){var x=u.getLinePath(u._points[w]),v=j.getColor(w),s=u.processAttr(u._cfg.points.attr,v.DEFAULT),y=u.processAttr(u._cfg.points.hoverAttr,v.HOVER);u._lines[w]={line:u.drawLine(x,{stroke:v.DEFAULT}),path:x,points:u._points[w],color:v,attr:e.mix({stroke:v.DEFAULT},u._cfg.line.attr)};u._stocks[w]={stocks:u.drawStocks(u._points[w],s),points:u._points[w],color:v,attr:s,hoverAttr:y}}}return u._lines},processAttr:function(t,s){var v=e.clone(t);for(var u in v){if(v[u]&&typeof v[u]=="string"){v[u]=v[u].replace(i,s)}}return v},drawStocks:function(v,s){var t=this,w=[];for(var u in v){if(v[u].x&&v[u].y){w.push(t.drawStock(v[u].x,v[u].y,s))}else{w.push("")}}return w},drawStock:function(t,A,s,v){var u=this,z=u.paper,w=u._cfg.points.attr;return z.circle(t,A,w.r,s).attr(w).attr(s)},drawGridsX:function(){var t=this,w=t._centerPoints;for(var v=0,s=w.length;v<s;v++){var u=t.drawGridX(w[v]);t._gridsX.push(u)}return t._gridsX},drawGridX:function(s,v){var u=this,z=u._innerContainer.tl.y,w=u._innerContainer.height,v=v||u._cfg.xGrids.css,x=u.htmlPaper,t=u._cfg.themeCls+"-gridsx";return x.lineY(s.x,z,w).addClass(t).css(u._cfg.xGrids.css)},drawGridY:function(s,x){var v=this,u=v._innerContainer.width,x=x||v._cfg.yGrids.css,y=v.htmlPaper,t=v._cfg.themeCls+"-gridsy";return y.lineX(s.x,s.y,u).addClass(t).css(x)},drawGridsY:function(){var u=this,t=u._innerContainer.tl.x,w=u._pointsY;for(var v=0,s=w.length;v<s;v++){u._gridsY[v]={0:u.drawGridY({x:t,y:w[v].y}),num:u.coordNum[v]}}},drawAreas:function(){var F=this,C,B=F._innerContainer.tl.y,E=F._points[0],D=E[1].x-E[0].x,v=F._innerContainer.height,t=F.htmlPaper,G=F._cfg.themeCls+"-areas",z=F._cfg.areas.css;for(var u=0,A=E.length;u<A;u++){var s=t.rect(E[u].x-D/2,B,D,v).addClass(G).css(z);F._areas.push(s)}},drawAxisX:function(){var v=this,u=v._innerContainer,y=u.bl,t=u.width,x=v.htmlPaper,s=v._cfg.themeCls+"-axisx";v._axisX=x.lineX(y.x,y.y,t).addClass(s).css(v._cfg.xAxis.css||{});return v._axisX},drawAxisY:function(){var v=this,t=v._innerContainer,u=t.tl,w=t.height,x=v.htmlPaper,s=v._cfg.themeCls+"-axisy";v._axisY=x.lineY(u.x,u.y,w).addClass(s).css(v._cfg.yAxis.css||{});return v._axisY},drawLabelsX:function(){var s=this,u=s._cfg.xAxis.text;for(var t in u){s._labelX[t]=s.drawLabelX(t,u[t])}},drawLabelsY:function(){var s=this;for(var t in s._pointsY){s._labelY[t]={0:s.drawLabelY(t,s._pointsY[t].number),num:s._pointsY[t].number}}return s._labelY},drawLabelX:function(w,y){var u=this,x=u.htmlPaper,z=u._pointsX,s=z.length||0,v,t=u._cfg.themeCls+"-xlabels";if(w<s){v=z[w];v[0]=x.text(v.x,v.y,"<span class="+t+">"+y+"</span>","center").css(u._cfg.xLabels.css);return v[0]}},drawLabelY:function(u,w){var t=this,v=t.htmlPaper,s=t._cfg.themeCls+"-ylabels";return v.text(t._pointsY[u].x,t._pointsY[u].y,"<span class="+s+">"+w+"</span>","right","middle").css(t._cfg.yLabels.css)},drawPointLines:function(){var u=this,w=u.htmlPaper,t=u._cfg.themeCls+"-pointlines",s=u._innerContainer;u._pointlines=[];for(var v in u._pointsX){u._pointlines.push(w.lineY(u._pointsX[v].x,s.tl.y,s.height).addClass(t).css({display:"none"}))}return u._pointlines},renderTip:function(){var v=this,u=v._cfg,s=v._innerContainer,w=u.tip.boundryDetect?{x:s.tl.x,y:s.tl.y,width:s.width,height:s.height}:{},t=e.mix(u.tip,{rootNode:v._$ctnNode,clsName:u.themeCls,boundry:w});v.tip=new l(t);return v.tip},renderEvtLayout:function(){var I=this,E,v=I._innerContainer,D=v.tl.y,G=I._points[0],F=G[1].x-G[0].x,A=v.height,J=I._multiple,s=I._evtEls._areas=[],H=I._evtEls._rects=[],t=I._evtEls.paper=new q(I._$ctnNode,{clsName:a,prependTo:false,width:v.width,height:A,left:v.tl.x,top:v.tl.y});for(var z=0,C=G.length;z<C;z++){s[z]=t.rect(G[z].x-F/2,v.tl.y,F,A).addClass(r)}if(J){for(var z in I._stocks){var B=I._stocks[z],H=[],G=B.points;if(B.stocks){for(var u in G){H[u]=t.rect(G[u].x-F/2,G[u].y-5,F,10).attr({line_index:z,index:u}).addClass(g)}I._evtEls._rects[z]=H}}}},clearEvtLayout:function(){var s=this;if(s._evtEls._areas){for(var u in s._evtEls._areas){s._evtEls._areas[u].remove()}}if(s._evtEls._rects){for(var u in s._evtEls._rects){for(var t in s._evtEls._rects[u]){s._evtEls._rects[u][t].remove()}}}},render:function(s){var u=this,t=u._cfg,v=t.themeCls;s&&u._$ctnNode.html("");u.paper=o(u._$ctnNode[0],t.width,t.height,{position:"absolute"});u.htmlPaper=new q(u._$ctnNode,{clsName:v});u.drawTitle();u.drawSubTitle();t.tip.isShow&&u.renderTip();t.areas.isShow&&u.drawAreas();t.xGrids.isShow&&u.drawGridsX();t.yGrids.isShow&&u.drawGridsY();t.pointLines.isShow&&u.drawPointLines();t.xAxis.isShow&&u.drawAxisX();t.yAxis.isShow&&u.drawAxisY();t.xLabels.isShow&&u.drawLabelsX();t.yLabels.isShow&&u.drawLabelsY();if(t.anim){u.drawLines(function(){u.renderEvtLayout();u.bindEvt();e.log("finish");u.afterRender()})}else{u.drawLines();u.renderEvtLayout();u.afterRender();u.bindEvt()}e.log(u)},bindEvt:function(){var t=this,s=t._cfg,x=t._evtEls,y=t._cfg.themeCls+"-areas-hover",w=(function(){for(var z in t._stocks){if(t._stocks[z]["stocks"]){return z}}})(),u=t._points[w],v=t._stocks[w];n.detach(d("."+g,d("."+a,t._$ctnNode)),"mouseenter");w&&n.on(d("."+g,d("."+a,t._$ctnNode)),"mouseenter",function(B){var z=d(B.currentTarget),A=z.attr("index"),C=z.attr("line_index");if(w!=C){w=C;t.lineChangeTo(w)}n.fire(d("."+r,d("."+a,t._$ctnNode))[A],"mouseenter")});n.detach(d("."+r,d("."+a,t._$ctnNode)),"mouseenter");w&&n.on(d("."+r,d("."+a,t._$ctnNode)),"mouseenter",function(C){var A=e.indexOf(this,d("."+r,d("."+a,t._$ctnNode)));v=t._stocks[w];for(var B in t._stocks){for(var z in t._stocks[B]["stocks"]){if(t._stocks[B]["stocks"][z]){t._stocks[B]["stocks"][z].attr(t._stocks[B].attr)}}}if(u&&u[A]&&u[A]["y"]){if(t._pointlines){for(var B in t._pointlines){t._pointlines[B].hide()}t._pointlines[A].show()}if(t._cfg.comparable){for(var B in t._stocks){t._stocks[B]["stocks"]&&t._stocks[B]["stocks"][A].attr(t._stocks[B]["hoverAttr"])}}else{v.stocks[A].attr(v.hoverAttr)}t._areas[A].addClass(t._cfg.themeCls+"-areas-hover").siblings().removeClass(t._cfg.themeCls+"-areas-hover");if(t._points[w][A].dataInfo){t.stockChange(w,A);t._cfg.tip.isShow&&t.tipHandler(w,A)}}});n.detach(x.paper.$paper,"mouseleave");w&&n.on(x.paper.$paper,"mouseleave",function(B){t._lines[w]["line"].attr(t._lines[w]["attr"]);t.tip&&t.tip.hide();for(var A in t._pointlines){t._pointlines[A].hide()}for(var A in t._areas){t._areas[A].removeClass(t._cfg.themeCls+"-areas-hover")}for(var A in t._stocks){for(var z in t._stocks[A]["stocks"]){if(t._stocks[A]["stocks"][z]){t._stocks[A]["stocks"][z].attr(t._stocks[A]["attr"])}}}t.paperLeave()})},lineChangeTo:function(w){var t=this,s=t._cfg;for(var v in t._lines){if(v!=w){t._lines[v]["line"].attr(t._lines[v].attr)}}t._lines[w]["line"].remove();for(var v in t._stocks[w]["stocks"]){t._stocks[w]["stocks"][v].remove()}t._lines[w]["line"]=t.drawLine(t.getLinePath(t._points[w]),{stroke:t.color.getColor(w).DEFAULT,"stroke-width":"4px"});t._stocks[w]["stocks"]=t.drawStocks(t._points[w],{fill:t.color.getColor(w).DEFAULT});for(var v in t._stocks){for(var u in t._stocks[v]["stocks"]){t._stocks[v]["stocks"][u].attr(s.points.attr)}}},hideLine:function(w){var s=this;p.prototype.removeData.call(s,w);s.animateGridsAndLabels();s._lines[w]["line"].remove();for(var u in s._stocks){if(w==u){for(var t in s._stocks[w]["stocks"]){s._stocks[w]["stocks"][t].remove()}delete s._stocks[w]["stocks"]}s._stocks[u]["points"]=s._points[u]}for(var u in s._lines){if(u!=w){var v=s.getLinePath(s._points[u]),x=s._lines[u]["path"];if(x!=v&&v!=""){s._lines[u]["line"].stop().animate({path:v},500);s._lines[u]["path"]=v;for(var t in s._stocks[u]["stocks"]){s._stocks[u]["stocks"][t].stop().animate({cx:s._stocks[u]["points"][t]["x"],cy:s._stocks[u]["points"][t]["y"]},500)}}}}s.clearEvtLayout();s.renderEvtLayout();s.bindEvt();e.log(s)},showLine:function(x){var t=this;p.prototype.recoveryData.call(t,x);t.animateGridsAndLabels();var s=t.getLinePath(t._points[x]);t._lines[x]["line"]=t.drawLine(s,t._lines[x]["attr"]);for(var v in t._stocks){t._stocks[v]["points"]=t._points[v]}for(var v in t._lines){if(v!=x){var w=t.getLinePath(t._points[v]),y=t._lines[v]["path"];if(y!=w){t._lines[v]["line"].stop().animate({path:w},500);t._lines[v]["path"]=w;for(var u in t._stocks[v]["stocks"]){t._stocks[v]["stocks"][u].stop().animate({cx:t._stocks[v]["points"][u]["x"],cy:t._stocks[v]["points"][u]["y"]},500)}}}}for(var v in t._stocks){if(x==v){t._stocks[x]["stocks"]=t.drawStocks(t._stocks[x]["points"],t._stocks[x]["attr"])}}t.clearEvtLayout();t.renderEvtLayout();t.bindEvt()},animateGridsAndLabels:function(){var u=this,t=Math.max(u._pointsY.length,u._gridsY.length),s=u.coordNum,x=function(y){for(var z in s){e.log(s[z]+" "+y);if(s[z]==y){return true}}return false},w=function(y){for(var z in u._pointsY){if(u._pointsY[z]["number"]==y){return u._pointsY[z]}}};for(var v in u._labelY){u._labelY[v][0].remove();u._gridsY[v][0].remove()}u.drawGridsY();u.drawLabelsY()},tipHandler:function(w,x){var A=this,s=A._lines[w]["color"]["DEFAULT"],z=A.tip,y=A._cfg,u=z.getInstance();if(A._cfg.comparable){var v={datas:{}},B=[];for(var t in A._points){if(A._stocks[t]["stocks"]){v.datas[t]=e.mix(A._points[t][x].dataInfo,{text:A._cfg.series[t]["text"]||"",color:A._stocks[t]["color"]["DEFAULT"]})}}for(var t in v.datas){B.push(v.datas[t])}v.datas=p.prototype.arraySort(B,true,"y");z.renderTemplate(A._cfg.tip.template,v)}else{z.renderTemplate(A._cfg.tip.template,A._points[w][x].dataInfo)}if(z.isVisable()){z.animateTo(A._points[w][x].x,A._points[w][x].y)}else{z.moveTo(A._points[w][x].x,A._points[w][x].y)}u.css(A.processAttr(y.tip.css,s))},paperLeave:function(){var s=this;s.fire("paperLeave",s)},stockChange:function(w,t){var s=this,u=s._stocks[w],v=e.mix({target:u.stocks[t],currentTarget:u.stocks[t],lineIndex:Math.round(w),stockIndex:Math.round(t)},u.points[t]);s.fire("stockChange",v)},afterRender:function(){var s=this;s.fire("afterRender",s)},getPaper:function(){return this.htmlPaper},clear:function(){return this.paper.clear()}});return b},{requires:["base","gallery/kcharts/1.0/raphael/index","gallery/kcharts/1.0/basechart/index","gallery/kcharts/1.0/tools/color/index","gallery/kcharts/1.0/tools/htmlpaper/index","gallery/kcharts/1.0/tip/index","./assets/kcharts-ui-core.css"]});
