KISSY.add("gallery/kcharts/1.0/basechart/index",function(d,c){var e=d.all;var a=function(){};d.extend(a,c,{init:function(f){var h=this,g;if(f&&f.renderTo){g=h._cfg=d.mix({zIndex:0,yAxis:{},canvasAttr:{x:60,y:60},defineDataKey:{}},f);h._$ctnNode=e(f.renderTo);h.getInnerContainer();d.mix(h,{_datas:{cur:{},total:{}},_points:{},_centerPoints:[],_pointsX:[],_pointsY:[],_gridsX:[],_gridsY:[],_stocks:[],_areas:[],_axisX:null,_axisY:null,_labelX:[],_labelY:[],_evtEls:[],_multiple:false});if(!g.series||g.series.length<=0||!g.series[0].data){return}g.series.length>1?h._multiple=true:undefined;for(var j in g.series){h._datas.total[j]={index:j,data:g.series[j].data};h._datas.cur[j]={index:j,data:g.series[j].data}}h.dataFormat()}},removeData:function(g){var f=this;delete f._datas.cur[g];f.dataFormat()},recoveryData:function(g){var f=this;f._datas.cur[g]=f._datas.total[g];f.dataFormat()},getInnerContainer:function(){var r=this,o=r._$ctnNode,i=d.mix(r._cfg.canvasAttr),k=i.width||(o.width()-2*i.x),f=i.height||(o.height()-2*i.y),m=i.x,l=i.y,g=k,n=f,q={x:m,y:l},j={x:m+k,y:l},h={x:m,y:l+n},p={x:m+k,y:l+n};r._innerContainer={x:m,y:l,width:g,height:n,tl:q,tr:j,bl:h,br:p};return r._innerContainer},dataFormat:function(){var q=this,o=q._cfg;var f=[];for(var w in q._datas.cur){var k=q.getArrayByKey(q._datas.cur[w]["data"],o.defineKey.y);f.push(k.join(","))}f=f.join(",").split(",");var p=q._innerContainer,n=p.x,m=p.y,t=p.width,r=p.height,l=o.yAxis.num||5,A=Math.max.apply(null,f),z=Math.min.apply(null,f),h=(A-z)*0.1,v=o.yAxis.max||o.yAxis.max==0?o.yAxis.max:A+h,u=o.yAxis.min||o.yAxis.min==0?o.yAxis.min:z-h,j=q.coordNum=q.getScales(v,u,l),g=q.data2GrapicData(j);q._pointsY=[];q._centerPoints=[];q.data2GrapicData(g);for(var w in g){q._pointsY[w]={number:j[w]+"",y:g[w],x:n}}for(var w in q._datas.cur){q._points[w]=q.getDataPoints(q._datas.cur[w]["data"])}if(q._points[0]&&q._points[0].length>1){var s=s?s:q._points[0][1].x-q._points[0][0].x;for(var w in q._points[0]){q._centerPoints[w]={x:q._points[0][w].x-s/2,y:0}}q._centerPoints.push({x:q._points[0][o.xAxis.text.length-1].x-(-s/2),y:0})}},data2GrapicData:function(h){if(!h){return}var n=this,o=n._innerContainer,k=o.y,m=o.height,l=Math.max.apply(null,n.coordNum),f=Math.min.apply(null,n.coordNum),j=[];if(h.length){for(var g in h){j.push(m*(1-(h[g]-f)/(l-f))+k)}return j}else{return m*(1-(h-f)/(l-f))+k}},getSplitPoints:function(p,o,n,m,j,l){var g=(n-p)/j,f=(m-o)/j,k=[];l&&k.push({x:p,y:o});for(var h=0;h<j-1;h++){k.push({x:p+(h+1)*g,y:o+(h+1)*f})}l&&k.push({x:p,y:o});return k},getScales:function(s,m,p){var f,t,j,o,h,u,l,r,v,k=Math.log,q=Math.pow,g=[];if(s<=m){return}f=(s-m)/p;o=Math.floor(k(f)/k(10))+1;t=f/q(10,o);if(t>0&&t<=0.1){t=0.1}else{if(t>0.1&&t<=0.2){t=0.2}else{if(t>0.2&&t<=0.25){t=0.25}else{if(t>0.25&&t<=0.5){t=0.5}else{t=1}}}}h=t*q(10,o);v=(s+m)/2-((s+m)/2)%h;l=r=v;while(l>m){l-=h}while(r<s){r+=h}for(var n=l;n<=r;n+=h){g.push(n)}return g},arraySort:function(h,f,g){return h.sort(function(j,i){if(!f){if(typeof j=="object"&&typeof i=="object"){return j[g]-i[g]}return j-i}else{if(typeof j=="object"&&typeof i=="object"){return i[g]-j[g]}return i-j}})},getArrayByKey:function(j,h){var g=[];for(var f in j){j[f][h]?g.push(j[f][h]):undefined}return g},obj2Array:function(j,h){var f=[];for(var g in j){f.push(h?j[h]:j[g])}return f},getObjKeys:function(g){var f=[];for(b in g){f.push(b)}return f},getDataPoints:function(D){var p=this,m=p._cfg,o=p._innerContainer,f=o.width/A+1,l=o.x,k=o.y,r=l-f/2,C=l+f/2,B=k+q,C=l+s,s=o.width,q=o.height,z=Math.max.apply(null,p.coordNum),t=Math.min.apply(null,p.coordNum),n=m.defineKey,h=n.x||"",g=n.y||"",A=m.xAxis.text.length||0,w=[],u=0;p._pointsX=p.getSplitPoints(l,k+q,l+s,k+q,A+1);for(var v in p._pointsX){if(m.xAxis.text[v]==D[u][h]){w[v]={x:p._pointsX[v].x,y:q*(1-(D[u][g]-t)/(z-t))+k,dataInfo:D[u],index:Math.round(v)};u++}else{w[v]={x:p._pointsX[v].x,index:Math.round(v)}}}return w}});return a},{requires:["base"]});
